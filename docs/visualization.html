<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 1 Visualization | Preceptor’s Primer for Bayesian Data Science</title>
<meta name="author" content="David Kane">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.8/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><script src="libs/rglWebGL-binding-0.106.8/rglWebGL.js"></script><link href="libs/rglwidgetClass-0.106.8/rgl.css" rel="stylesheet">
<script src="libs/rglwidgetClass-0.106.8/rglClass.min.js"></script><script src="libs/CanvasMatrix4-0.106.8/CanvasMatrix.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Preceptor’s Primer for Bayesian Data Science</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="preamble.html">Preamble</a></li>
<li><a class="" href="getting-started.html">Getting Started</a></li>
<li><a class="active" href="visualization.html"><span class="header-section-number">1</span> Visualization</a></li>
<li><a class="" href="wrangling.html"><span class="header-section-number">2</span> Wrangling</a></li>
<li><a class="" href="data.html"><span class="header-section-number">3</span> Data</a></li>
<li><a class="" href="rubin-causal-model.html"><span class="header-section-number">4</span> Rubin Causal Model</a></li>
<li><a class="" href="probability.html"><span class="header-section-number">5</span> Probability</a></li>
<li><a class="" href="one-parameter.html"><span class="header-section-number">6</span> One Parameter</a></li>
<li><a class="" href="two-parameters.html"><span class="header-section-number">7</span> Two Parameters</a></li>
<li><a class="" href="three-parameters.html"><span class="header-section-number">8</span> Three Parameters</a></li>
<li><a class="" href="four-parameters.html"><span class="header-section-number">9</span> Four Parameters</a></li>
<li><a class="" href="five-parameters.html"><span class="header-section-number">10</span> Five Parameters</a></li>
<li><a class="" href="n-parameters.html"><span class="header-section-number">11</span> N Parameters</a></li>
<li><a class="" href="tools.html">Tools</a></li>
<li><a class="" href="functions.html">Functions</a></li>
<li><a class="" href="maps.html">Maps</a></li>
<li><a class="" href="ipums.html">IPUMS</a></li>
<li><a class="" href="animation.html">Animation</a></li>
<li><a class="" href="set-up-for-working-on-the-primer.html">Set Up for Working on The Primer</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/PPBDS/primer">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="visualization" class="section level1" number="1">
<h1>
<span class="header-section-number">1</span> Visualization<a class="anchor" aria-label="anchor" href="#visualization"><i class="fas fa-link"></i></a>
</h1>
<p>Everyone loves visualizations.</p>
<!-- Heather owns this Chapter! Change anything an everything! Change anything you like in Getting Started. -->
<!-- Cut out all R and R Studio section. Place cool/useful parts of it in Getting Started. -->
<!-- Talk more about aesthetics (i.e., aes()) in Basic plots. Make more use of color and fill. Explain how you can use either constants (like "steelblue") or variables (like party) when using these aesthetics. -->
<!-- Add the formula for median, like this one: https://math.stackexchange.com/questions/1097546/what-is-the-general-formula-for-calculating-the-median -->
<!-- Better explain Tidyverse. -->
<!-- Don't do this yet. Same with the `group` aesthetic, especially for line plots. Don't use the unemployment data anymore. Use two or three of the temperature series from primer.data::temperature. -->
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-40-1.png" width="100%"></div>
<p>Once you have read this chapter, and completed the associated tutorials, you will be able to create graphics like this one with your data. Join us on the journey.</p>
<div id="basic-r-commands" class="section level2" number="1.1">
<h2>
<span class="header-section-number">1.1</span> Basic R commands<a class="anchor" aria-label="anchor" href="#basic-r-commands"><i class="fas fa-link"></i></a>
</h2>
<p>We use the terms “coding” and “programming” interchangeably. With the rest of this <em>Primer</em>, we will use a different font to distinguish regular text from <code>computer_code</code>. If you’d like to follow along with this section, you can open open the <em>Console pane</em> in RStudio.</p>
<ul>
<li><p><em>Running code</em>: the act of telling R to put our code into action.</p></li>
<li><p><em>Objects</em>: where values are stored in R. You can <em>assign</em> values to objects and display the contents of objects. Use the assignment operator <code><a href="https://rdrr.io/r/base/assignOps.html">&lt;-</a></code> to do so. You can choose almost any name you like for an object, as long as the name does not begin with a number or a special character like <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">*</a></code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">/</a></code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">^</a></code>, etc.</p></li>
</ul>
<p>For example we can save the result of <code>4 + 3</code> to an object named <code>x</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">4</span> <span class="op">+</span> <span class="fl">3</span></code></pre></div>
<p>Now, whenever we type <code>x</code>, the value of 4 + 3 will appear:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span></code></pre></div>
<pre><code>## [1] 7</code></pre>
<ul>
<li>
<em>Data types</em>: integers, doubles/numerics, logicals, and characters.
<ul>
<li>Integers are values like -1, 0, 2, 4092.</li>
<li>Doubles or numerics are a larger set of values containing both the integers but also fractions and decimal values like -24.932 and 0.8.</li>
<li>Logicals are either <code>TRUE</code> or <code>FALSE</code>. Characters are text like “cabbage,” “Hamilton,” or “The Wire is the greatest TV show ever.”</li>
<li>Characters are often denoted with the quotation marks around them.</li>
</ul>
</li>
<li>
<em>Vectors</em>: a collection of values. These are created using the <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> function, where the <code>c</code> stands for <strong>c</strong>ombine.</li>
</ul>
<p>For example, <code><a href="https://rdrr.io/r/base/c.html">c(2, 4, 6, 8)</a></code> creates a four element vector of numeric values.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1 2 3 4</code></pre>
<ul>
<li>
<em>Factors</em>: used to represent “categorical data.” We will go into detail about these and other variable types in Chapter <a href="wrangling.html#wrangling">2</a>.</li>
</ul>
<!-- Explain factors and categorical data more, even after reading wrangling I'm still somewhat unsure what it means and it might be good to have a more in-depth explanation here for those of us who aren't super familiar with data terms. Maybe just a paragraph.  --><ul>
<li>
<em>Data frames</em>: rectangular arrangements of data. Think of a <a href="https://en.wikipedia.org/wiki/Spreadsheet">spreadsheet</a>. Rows correspond to <em>units</em>. Columns correspond to <em>variables</em>. Modern data frames are called <em>tibbles</em>.</li>
</ul>
<!-- It's somewhat unclear what "modern data frame" means, maybe elaborate. --><ul>
<li><p><em>Boolean algebra</em>: <code>TRUE/FALSE</code> statements and mathematical operators such as <code><a href="https://rdrr.io/r/base/Comparison.html">&lt;</a></code> (less than), <code><a href="https://rdrr.io/r/base/Comparison.html">&lt;=</a></code> (less than or equal to), and <code><a href="https://rdrr.io/r/base/Comparison.html">!=</a></code> (not equal to). For example, <code>4 + 2 &gt;= 3</code> will return <code>TRUE</code>, but <code>3 + 5 &lt;= 1</code> will return <code>FALSE</code>.</p></li>
<li><p><em>Inclusion</em>: Tested for with the <code><a href="https://rdrr.io/r/base/match.html">%in%</a></code> operator. For example, <code>"B" %in% c("A", "B")</code> returns <code>TRUE</code> while <code>"C" %in% c("A", "B")</code> returns <code>FALSE</code>.</p></li>
<li><p><em>Equality</em>: Tested for using <code><a href="https://rdrr.io/r/base/Comparison.html">==</a></code>. For example, <code>2 + 1 == 3</code> compares <code>2 + 1</code> to <code>3</code> and is legal R code, returning <code>TRUE</code>. On the other hand, <code>2 + 1 = 3</code> will return an error because we can not assign one number to another.</p></li>
<li><p><em>Logical operators</em>: <code><a href="https://rdrr.io/r/base/Logic.html">&amp;</a></code> representing “and” as well as <code><a href="https://rdrr.io/r/base/Logic.html">|</a></code> representing “or.” For example, <code>(2 + 1 == 3) &amp; (2 + 1 == 4)</code> returns <code>FALSE</code> since at least one of the two parts is not <code>TRUE</code>. On the other hand, <code>(2 + 1 == 3) | (2 + 1 == 4)</code> returns <code>TRUE</code> since at least one of the two parts is <code>TRUE</code>.</p></li>
<li><p><em>Functions</em>: perform tasks, and are also called <em>commands</em>. They take in inputs called <em>arguments</em> and return outputs. You can either manually specify a function’s arguments or use the function’s <em>default values</em>.</p></li>
</ul>
<p>For example, <code><a href="https://rdrr.io/r/base/MathFun.html">sqrt(64)</a></code> is the function <code><a href="https://rdrr.io/r/base/MathFun.html">sqrt()</a></code> with 64 as its argument.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">64</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 8</code></pre>
<ul>
<li><p><em>Help files</em>: provide documentation for functions and datasets. You can bring up help files by adding a <code><a href="https://rdrr.io/r/utils/Question.html">?</a></code> before the name of the object then run this in the console.</p></li>
<li><p><em>Code comments</em>: are text placed after a <code>#</code> symbol. Nothing will be run after a <code>#</code> symbol, which is useful when you include comments in your code, as you always should.</p></li>
<li><p><em>Errors, warnings, and messages</em>: generally reported in a red font. When there is an error, the code will not run. Read (and/or google) the message and try fix it. Warnings don’t prevent code from completing. For example, if you create a scatterplot based on data with two missing values, you will see this warning:</p></li>
</ul>
<pre><code>Warning message:
Removed 2 rows containing missing values (geom_point).  </code></pre>
<!-- DK: Indent this so that it is connected to the bullet point above. -->
<p>Messages are similar. In both cases, you should fix the underlying issue until the warning/message goes away.</p>
</div>
<div id="looking-at-data" class="section level2" number="1.2">
<h2>
<span class="header-section-number">1.2</span> Looking at data<a class="anchor" aria-label="anchor" href="#looking-at-data"><i class="fas fa-link"></i></a>
</h2>
<p>This chapter focuses on <strong>ggplot2</strong>, one of the core packages in the <strong>tidyverse</strong>. The <strong>tidyverse</strong> is a package that contains 8 individual packages, most importantly <strong>ggplot2</strong>, but also other packages that help us view data within R. To access the datasets, help pages, and functions that we will use in this chapter, load the tidyverse:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></code></pre></div>
<p>That one line of code loads all the packages associated with the <strong>tidyverse</strong>, packages which you will use in almost every data analysis. The first time you load the tidyverse, R will report which functions from the tidyverse conflict with functions in base R or with other packages you may have loaded. (We hide these and other messages in this book because they are ugly.)</p>
<p>You might get this error message:</p>
<pre><code>Error in library(tidyverse) : there is no package called ‘tidyverse’</code></pre>
<p>If that happens, you need to install the package:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"tidyverse"</span><span class="op">)</span></code></pre></div>
<p>Then, run <code><a href="https://tidyverse.tidyverse.org">library(tidyverse)</a></code> once again.</p>
<div id="examining-trains" class="section level3" number="1.2.1">
<h3>
<span class="header-section-number">1.2.1</span> Examining <code>trains</code><a class="anchor" aria-label="anchor" href="#examining-trains"><i class="fas fa-link"></i></a>
</h3>
<p>Most data comes to us in “spreadsheet”-type format. These datasets are called <em>data frames</em> or <em>tibbles</em> in R. Let’s explore the <code>trains</code> tibble from the <strong>primer.data</strong> package. This data comes from <span class="citation"><a href="references.html#ref-enos2014" role="doc-biblioref">Enos</a> (<a href="references.html#ref-enos2014" role="doc-biblioref">2014</a>)</span>, which investigated attitudes toward immigration among Boston commuters.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">primer.data</span><span class="op">)</span>
<span class="va">trains</span></code></pre></div>
<pre><code>## # A tibble: 115 x 14
##    treatment att_start att_end gender race  liberal party     age income line   
##    &lt;fct&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;lgl&gt;   &lt;chr&gt;   &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;  
##  1 Treated          11      11 Female White FALSE   Democr…    31 135000 Framin…
##  2 Treated           9      10 Female White FALSE   Republ…    34 105000 Framin…
##  3 Treated           3       5 Male   White TRUE    Democr…    63 135000 Framin…
##  4 Treated          11      11 Male   White FALSE   Democr…    45 300000 Framin…
##  5 Control           8       5 Male   White TRUE    Democr…    55 135000 Framin…
##  6 Treated          13      13 Female White FALSE   Democr…    37  87500 Framin…
##  7 Control          13      13 Female White FALSE   Republ…    53  87500 Framin…
##  8 Treated          10      11 Male   White FALSE   Democr…    36 135000 Framin…
##  9 Control          12      12 Female White FALSE   Democr…    54 105000 Framin…
## 10 Treated           9      10 Male   White FALSE   Republ…    42 135000 Framin…
## # … with 105 more rows, and 4 more variables: station &lt;chr&gt;, hisp_perc &lt;dbl&gt;,
## #   ideology_start &lt;int&gt;, ideology_end &lt;int&gt;</code></pre>
<p>Let’s unpack this output:</p>
<ul>
<li><p>A <code>tibble</code> is a specific kind of data frame. This particular data frame has 115 rows corresponding to different <em>units</em>, meaning people in this case.</p></li>
<li><p>The tibble also has 14 columns corresponding to <em>variables</em> which describe each unit or observation.</p></li>
<li><p>We see, by default, the top 10 rows and some of the columns. You can see more (or fewer) rows and columns by using the <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> command:</p></li>
</ul>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">trains</span>, n <span class="op">=</span> <span class="fl">15</span>, width <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 115 x 14
##    treatment att_start att_end gender race  liberal party        age income
##    &lt;fct&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;lgl&gt;   &lt;chr&gt;      &lt;int&gt;  &lt;dbl&gt;
##  1 Treated          11      11 Female White FALSE   Democrat      31 135000
##  2 Treated           9      10 Female White FALSE   Republican    34 105000
##  3 Treated           3       5 Male   White TRUE    Democrat      63 135000
##  4 Treated          11      11 Male   White FALSE   Democrat      45 300000
##  5 Control           8       5 Male   White TRUE    Democrat      55 135000
##  6 Treated          13      13 Female White FALSE   Democrat      37  87500
##  7 Control          13      13 Female White FALSE   Republican    53  87500
##  8 Treated          10      11 Male   White FALSE   Democrat      36 135000
##  9 Control          12      12 Female White FALSE   Democrat      54 105000
## 10 Treated           9      10 Male   White FALSE   Republican    42 135000
## 11 Control          10       9 Female White FALSE   Democrat      33 105000
## 12 Treated          11       9 Male   White FALSE   Democrat      50 250000
## 13 Treated          13      13 Male   White FALSE   Republican    24 105000
## 14 Control           6       7 Male   White TRUE    Democrat      40  62500
## 15 Control           8       8 Male   White TRUE    Democrat      53 300000
##    line       station      hisp_perc ideology_start ideology_end
##    &lt;chr&gt;      &lt;chr&gt;            &lt;dbl&gt;          &lt;int&gt;        &lt;int&gt;
##  1 Framingham Grafton         0.0264              3            3
##  2 Framingham Southborough    0.0154              4            4
##  3 Framingham Grafton         0.0191              1            2
##  4 Framingham Grafton         0.0191              4            4
##  5 Framingham Grafton         0.0191              2            2
##  6 Framingham Grafton         0.0231              5            5
##  7 Framingham Grafton         0.0304              5            5
##  8 Framingham Grafton         0.0247              4            4
##  9 Framingham Grafton         0.0247              4            3
## 10 Framingham Grafton         0.0259              4            4
## 11 Framingham Grafton         0.0259              3            3
## 12 Framingham Grafton         0.0259              5            4
## 13 Framingham Grafton         0.0159              4            4
## 14 Framingham Grafton         0.0159              1            1
## 15 Framingham Southborough    0.0392              2            2
## # … with 100 more rows</code></pre>
<p>The <code>n</code> argument to <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> tells R the number of rows you want to see. <code>width</code> refers to the number of characters to print across the screen. Want to see every row and every column? Try:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">trains</span>, n <span class="op">=</span> <span class="cn">Inf</span>, width <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></code></pre></div>
<p><code>Inf</code> is an R object which means “infinity.”</p>
</div>
<div id="exploring-tibbles" class="section level3" number="1.2.2">
<h3>
<span class="header-section-number">1.2.2</span> Exploring tibbles<a class="anchor" aria-label="anchor" href="#exploring-tibbles"><i class="fas fa-link"></i></a>
</h3>
<p>There are many ways to get a feel for the data contained in a tibble like <code>trains</code>.</p>
<div id="view" class="section level4" number="1.2.2.1">
<h4>
<span class="header-section-number">1.2.2.1</span> <code>view()</code><a class="anchor" aria-label="anchor" href="#view"><i class="fas fa-link"></i></a>
</h4>
<p>Run <code>view(trains)</code> in the Console in RStudio. Explore this tibble in the resulting pop up viewer.</p>
<p><code>view()</code> allows us to explore the different variables listed in the columns. Observe that there are many different types of variables. Some of the variables are <em>quantitative</em>. These variables are numerical in nature. Other variables here, including <code>gender</code> and <code>treatment</code>, are <em>categorical</em>. Categorical variables can only take on one of a limited possibility, like educational level can only be one of limited possibilities like high school, elementary school, university, etc.</p>
</div>
<div id="glimpse" class="section level4" number="1.2.2.2">
<h4>
<span class="header-section-number">1.2.2.2</span> <code>glimpse()</code><a class="anchor" aria-label="anchor" href="#glimpse"><i class="fas fa-link"></i></a>
</h4>
<p>We can also explore a tibble by using <code>glimpse()</code>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">glimpse</span><span class="op">(</span><span class="va">trains</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 115
## Columns: 14
## $ treatment      &lt;fct&gt; Treated, Treated, Treated, Treated, Control, Treated, C…
## $ att_start      &lt;dbl&gt; 11, 9, 3, 11, 8, 13, 13, 10, 12, 9, 10, 11, 13, 6, 8, 1…
## $ att_end        &lt;dbl&gt; 11, 10, 5, 11, 5, 13, 13, 11, 12, 10, 9, 9, 13, 7, 8, 1…
## $ gender         &lt;chr&gt; "Female", "Female", "Male", "Male", "Male", "Female", "…
## $ race           &lt;chr&gt; "White", "White", "White", "White", "White", "White", "…
## $ liberal        &lt;lgl&gt; FALSE, FALSE, TRUE, FALSE, TRUE, FALSE, FALSE, FALSE, F…
## $ party          &lt;chr&gt; "Democrat", "Republican", "Democrat", "Democrat", "Demo…
## $ age            &lt;int&gt; 31, 34, 63, 45, 55, 37, 53, 36, 54, 42, 33, 50, 24, 40,…
## $ income         &lt;dbl&gt; 135000, 105000, 135000, 300000, 135000, 87500, 87500, 1…
## $ line           &lt;chr&gt; "Framingham", "Framingham", "Framingham", "Framingham",…
## $ station        &lt;chr&gt; "Grafton", "Southborough", "Grafton", "Grafton", "Graft…
## $ hisp_perc      &lt;dbl&gt; 0.026, 0.015, 0.019, 0.019, 0.019, 0.023, 0.030, 0.025,…
## $ ideology_start &lt;int&gt; 3, 4, 1, 4, 2, 5, 5, 4, 4, 4, 3, 5, 4, 1, 2, 2, 3, 4, 2…
## $ ideology_end   &lt;int&gt; 3, 4, 2, 4, 2, 5, 5, 4, 3, 4, 3, 4, 4, 1, 2, 3, 3, 1, 2…</code></pre>
<p>We see the first few values for each variable in a row after the variable name. In addition, the <em>data type</em> of the variable is given immediately after each variable’s name, inside <code>&lt; &gt;</code>.</p>
<p><code>dbl</code> refers to “double,” which is computer terminology for quantitative/numerical variables. <code>int</code> is for “integer.” <code>fct</code> is refers to a “factor,” a variable that is “nominal,” meaning a member of a smallish number of categories. <code>chr</code> is for character data.</p>
</div>
<div id="summary-1" class="section level4" number="1.2.2.3">
<h4>
<span class="header-section-number">1.2.2.3</span> <code>summary()</code><a class="anchor" aria-label="anchor" href="#summary-1"><i class="fas fa-link"></i></a>
</h4>
<p>Use<code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> to get a sense of the distribution of the variables in the tibble.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">trains</span><span class="op">)</span></code></pre></div>
<pre><code>##    treatment    att_start       att_end        gender         
##  Treated:51   Min.   : 3.0   Min.   : 3.0   Length:115        
##  Control:64   1st Qu.: 7.0   1st Qu.: 7.0   Class :character  
##               Median : 9.0   Median : 9.0   Mode  :character  
##               Mean   : 9.2   Mean   : 9.1                     
##               3rd Qu.:11.0   3rd Qu.:11.0                     
##               Max.   :15.0   Max.   :15.0                     
##                                                               
##      race            liberal           party                age    
##  Length:115         Mode :logical   Length:115         Min.   :20  
##  Class :character   FALSE:64        Class :character   1st Qu.:33  
##  Mode  :character   TRUE :51        Mode  :character   Median :43  
##                                                        Mean   :42  
##                                                        3rd Qu.:52  
##                                                        Max.   :68  
##                                                                    
##      income           line             station            hisp_perc   
##  Min.   : 23500   Length:115         Length:115         Min.   :0.01  
##  1st Qu.: 87500   Class :character   Class :character   1st Qu.:0.02  
##  Median :135000   Mode  :character   Mode  :character   Median :0.03  
##  Mean   :141813                                         Mean   :0.04  
##  3rd Qu.:135000                                         3rd Qu.:0.04  
##  Max.   :300000                                         Max.   :0.26  
##                                                         NA's   :1     
##  ideology_start  ideology_end
##  Min.   :1.0    Min.   :1.0  
##  1st Qu.:2.0    1st Qu.:2.0  
##  Median :3.0    Median :3.0  
##  Mean   :2.8    Mean   :2.7  
##  3rd Qu.:4.0    3rd Qu.:3.5  
##  Max.   :5.0    Max.   :5.0  
## </code></pre>
</div>
<div id="operator" class="section level4" number="1.2.2.4">
<h4>
<span class="header-section-number">1.2.2.4</span> <code>$</code> operator<a class="anchor" aria-label="anchor" href="#operator"><i class="fas fa-link"></i></a>
</h4>
<p>The <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> operator allows us to extract a single variable from a tibble and return it as a vector.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains</span><span class="op">$</span><span class="va">age</span></code></pre></div>
<pre><code>##   [1] 31 34 63 45 55 37 53 36 54 42 33 50 24 40 53 50 33 33 32 57 41 36 43 25 41
##  [26] 33 44 46 41 28 36 37 38 48 20 52 38 45 55 38 45 44 36 29 42 43 54 39 31 50
##  [51] 60 67 54 44 50 20 57 25 60 44 35 54 52 47 60 47 22 56 50 21 29 45 46 42 23
##  [76] 29 60 41 30 61 21 46 53 45 46 63 21 31 35 22 68 27 22 30 59 56 32 35 23 60
## [101] 50 31 43 30 54 52 52 50 37 27 55 42 68 52 50</code></pre>
</div>
</div>
</div>
<div id="basic-plots" class="section level2" number="1.3">
<h2>
<span class="header-section-number">1.3</span> Basic Plots<a class="anchor" aria-label="anchor" href="#basic-plots"><i class="fas fa-link"></i></a>
</h2>
<p>There are three essential components to a plot:</p>
<ul>
<li>
<code>data</code>: the dataset containing the variables of interest.</li>
<li>
<code>geom</code>: the geometric object to display, e.g., scatterplot, line, bar.</li>
<li>
<code>aes</code>: aesthetic attributes of the geometric object. The most important are the names of the variables that should be on the x and y axes. Additional attributes include color and size. Aesthetic attributes are <em>mapped</em> to variables in the dataset.</li>
</ul>
<p>Consider a basic scatterplot using data from <span class="citation"><a href="references.html#ref-enos2014" role="doc-biblioref">Enos</a> (<a href="references.html#ref-enos2014" role="doc-biblioref">2014</a>)</span> for 115 Boston commuters.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">trains</span>, 
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, 
                     y <span class="op">=</span> <span class="va">income</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-53-1.png" width="100%"></div>
<p>Notice how <code>data</code> and <code>aes</code> are specified in the call to <code>ggplot()</code>, followed by our choice of geom.</p>
<p>Plots are composed of <em>layers</em>, combined using the <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> sign. The most essential layer specifies which type of <code>geom</code>etric object we want the plot to involve: points, lines, bars, and others. In our graph above, the geom we used is <code>geom_point()</code>.</p>
<p>The <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> sign comes at the end of the code line and not at the beginning. When adding layers to a plot, start a new line after the <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> so that the code for each layer is on a new line.</p>
<div id="geom_point" class="section level3" number="1.3.1">
<h3>
<span class="header-section-number">1.3.1</span> <code>geom_point()</code><a class="anchor" aria-label="anchor" href="#geom_point"><i class="fas fa-link"></i></a>
</h3>
<p><em>Scatterplots</em>, also called <em>bivariate plots</em>, allow you to visualize the <em>relationship</em> between two numerical variables.</p>
<p>Recall our scatterplot from above.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">trains</span>, 
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, 
                     y <span class="op">=</span> <span class="va">income</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-54-1.png" width="100%"></div>
<p>Let’s break down this code, piece-by-piece.</p>
<ul>
<li><p>The <code>data</code> argument is set to <code>trains</code> via <code>data = trains</code>.</p></li>
<li><p>The <code>aes</code>thetic <code>mapping</code> is set via <code>mapping = aes(x = age, y = income)</code>. Here, we map <code>age</code> to the <code>x</code> axis and <code>income</code> to the <code>y</code> axis.</p></li>
<li><p>The <code>geom</code>etric object is specified using <code>geom_point()</code>, telling R we want a scatterplot. We added a layer using the <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> sign.</p></li>
</ul>
<p>If we do not specify the <code>geom</code>etric object, we have a blank plot:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">trains</span>, 
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, 
                     y <span class="op">=</span> <span class="va">income</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-55-1.png" width="100%"></div>
<p>In addition to mapping variables to the <code>x</code> and <code>y</code> axes, we can also map variables to <code>color</code>.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">trains</span>, 
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, 
                     y <span class="op">=</span> <span class="va">income</span>,
                     color <span class="op">=</span> <span class="va">party</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-56-1.png" width="100%"></div>
<!-- Size here? -->
<p>We use the function <code>labs()</code> to add a plot title, axis labels, subtitles, and captions to our graph. By default, R simply uses the names of variables for axes and legends. Add better titles and labels.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">trains</span>, 
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, 
                     y <span class="op">=</span> <span class="va">income</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Age and Income Among Boston Commuters"</span>,
       subtitle <span class="op">=</span> <span class="st">"Older commuters don't seem to make more money"</span>,
       x <span class="op">=</span> <span class="st">"Age"</span>,
       y <span class="op">=</span> <span class="st">"Income"</span>,
       caption <span class="op">=</span> <span class="st">"Data source: Enos (2014)"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-57-1.png" width="100%"></div>
<p>Note that like with <code>geom</code>s, we add a layer using <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> when creating <code>labs()</code>for our plot. In general, every plot should give a title and axes labels. You should also add a <code>subtitle</code>, the purpose of which is to give a short “main point” of the graphic. What do you want the viewer to notice? You should also provide the source for the data, usually via the <code>caption</code> argument.</p>
<p>Let’s now take a tour of some of the more useful geoms.</p>
</div>
<div id="geom_jitter" class="section level3" number="1.3.2">
<h3>
<span class="header-section-number">1.3.2</span> <code>geom_jitter()</code><a class="anchor" aria-label="anchor" href="#geom_jitter"><i class="fas fa-link"></i></a>
</h3>
<p>Consider a different scatter plot using the <code>trains</code> data.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">trains</span>, 
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">att_start</span>, 
                     y <span class="op">=</span> <span class="va">att_end</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Immigration Attitudes Among Boston Commuters"</span>,
       subtitle <span class="op">=</span> <span class="st">"Attitudes did not change much after the experiment"</span>,
       x <span class="op">=</span> <span class="st">"Attitude Before Experiment"</span>,
       y <span class="op">=</span> <span class="st">"Attitude After Experiment"</span>,
       caption <span class="op">=</span> <span class="st">"Data source: Enos (2014)"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-58-1.png" width="100%"></div>
<p>The problem with this display is “overplotting.” Because attitudes are measured as integers, we do not know if a given point represents just one person or a dozen. There are two methods we can use to address overplotting: transparency and jitter.</p>
<p><strong>Method 1: Changing the transparency</strong></p>
<p>We can change the transparency/opacity of the points by using the <code>alpha</code> argument within <code>geom_point()</code>. The <code>alpha</code> argument can be set to any value between <code>0</code> and <code>1</code>, where <code>0</code> sets the points to be 100% transparent and <code>1</code> sets the points to be 100% opaque. By default, <code>alpha</code> is set to <code>1</code>.</p>
<p>Use a new <code>alpha</code> value to the scatterplot.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">trains</span>, 
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">att_start</span>, 
                     y <span class="op">=</span> <span class="va">att_end</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Immigration Attitudes Among Boston Commuters"</span>,
       subtitle <span class="op">=</span> <span class="st">"Attitudes did not change much after the experiment"</span>,
       x <span class="op">=</span> <span class="st">"Attitude Before Experiment"</span>,
       y <span class="op">=</span> <span class="st">"Attitude After Experiment"</span>,
       caption <span class="op">=</span> <span class="st">"Data source: Enos (2014)"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-59-1.png" width="100%"></div>
<p>Note that there is no <code>aes()</code> surrounding <code>alpha = 0.2</code>. This is because we are not mapping a variable to an aesthetic attribute, but only changing the default setting of <code>alpha</code>.</p>
<p><strong>Method 2: Jittering the points</strong></p>
<p>We can also decide to jitter the points on the plot. We do this by replacing <code>geom_point()</code> with <code>geom_jitter()</code>. Keep in mind that jittering is strictly a visualization tool; even after creating a jittered scatterplot, the original values saved in the data frame remain unchanged.</p>
<p>In order to specify how much jitter to add, we use the <code>width</code> and <code>height</code> arguments to <code>geom_jitter()</code>. This corresponds to how hard you’d like to shake the plot in horizontal x-axis units and vertical y-axis units, respectively. It is important to add just enough jitter to break any overlap in points, but not to the extent where you alter the original pattern in points.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">trains</span>, 
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">att_start</span>, 
                     y <span class="op">=</span> <span class="va">att_end</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_jitter</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Immigration Attitudes Among Boston Commuters"</span>,
       subtitle <span class="op">=</span> <span class="st">"Attitudes did not change much after the experiment"</span>,
       x <span class="op">=</span> <span class="st">"Attitude Before Experiment"</span>,
       y <span class="op">=</span> <span class="st">"Attitude After Experiment"</span>,
       caption <span class="op">=</span> <span class="st">"Data source: Enos (2014)"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-60-1.png" width="100%"></div>
<p>When deciding whether to jitter a scatterplot or use the <code>alpha</code> argument to <code>geom_point()</code>, know that there is no single right answer. We suggest you play around with both methods to see which one better emphasizes the point you are trying to make.</p>
</div>
<div id="geom_line" class="section level3" number="1.3.3">
<h3>
<span class="header-section-number">1.3.3</span> <code>geom_line()</code><a class="anchor" aria-label="anchor" href="#geom_line"><i class="fas fa-link"></i></a>
</h3>
<p>Linegraphs show the relationship between two numerical variables when the variable on the x-axis, also called the <em>explanatory</em>, <em>predictive</em>, or <em>independent</em> variable, is of a sequential nature. In other words, there is an inherent ordering to the variable.</p>
<div class="inline-figure"><img src="https://imgs.xkcd.com/comics/decline.png" width="100%"></div>
<p>The most common examples of linegraphs have some notion of time on the x-axis: hours, days, weeks, years, etc. Since time is sequential, we connect consecutive observations of the variable on the y-axis with a line. Linegraphs that have some notion of time on the x-axis are also called <em>time series</em> plots.</p>
<p>Let’s plot the median duration of unemployment in the United States over the last 50 years.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">economics</span>,
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">uempmed</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Unemployment Duration in the United States: 1965 -- 2015"</span>,
       subtitle <span class="op">=</span> <span class="st">"Dramatic increase in duration after the Great Recesssion"</span>,
       x <span class="op">=</span> <span class="st">"Date"</span>,
       y <span class="op">=</span> <span class="st">"Median Duration in Weeks"</span>,
       caption <span class="op">=</span> <span class="st">"Source: FRED Economic Data"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-62-1.png" width="100%"></div>
<p>Almost every aspect of the code used to create this plot is identical to our scatter plots, except for the geom we used.</p>
</div>
<div id="geom_histogram" class="section level3" number="1.3.4">
<h3>
<span class="header-section-number">1.3.4</span> <code>geom_histogram()</code><a class="anchor" aria-label="anchor" href="#geom_histogram"><i class="fas fa-link"></i></a>
</h3>
<!-- DK: All awk. Rewrite. Passing by position is important! -->
<p>A histogram is a plot that visualizes the <em>distribution</em> of a numerical value.</p>
<ol style="list-style-type: decimal">
<li>We first cut up the x-axis into a series of <em>bins</em>, where each bin represents a range of values.</li>
<li>For each bin, we count the number of observations that fall in the range corresponding to that bin.</li>
<li>We draw a bar whose height indicates the corresponding count.</li>
</ol>
<p>Let’s consider the <code>income</code> variable from the the <code>trains</code> tibble. Pay attention to how we have changed the two arguments to <code>ggplot()</code>. We have removed <code>data =</code> and <code>mapping =</code>. The code still works because R functions allow for passing in arguments by <em>position</em>. The first argument to <code>ggplot()</code> is the <code>data</code>. We don’t need to tell R that <code>trains</code> is the value for <code>data</code>. R assumes that it is because we passed it in as the first argument. Similarly, the second argument to <code>ggplot()</code> is <code>mapping</code>, so R assumes that <code>aes(x = income)</code> is the value we want for <code>mapping</code> because it is the second item passed in.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">trains</span>, 
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">income</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-63-1.png" width="100%"></div>
<p>Note the message printed above:</p>
<blockquote>
<p><code>stat_bin()</code> using <code>bins = 30</code>. Pick better value with <code>binwidth</code>.</p>
</blockquote>
<p>You would get the same message if you ran this code yourself. Try it!</p>
<p>The message is telling us that the histogram was constructed using <code>bins = 30</code> for 30 equally spaced bins. This is the default value. Unless you override this default number of bins with a number you specify, R will choose 30 by default. Because this is an important aspect of making a histogram, R insists on informing you with this message. You make this message go away by specifying the <code>bin</code> number yourself, as you should always do.</p>
<p>Let’s specify <code>bins</code> and also add some labels.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">trains</span>, 
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">income</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Income Among Boston Commuter"</span>,
       subtitle <span class="op">=</span> <span class="st">"Why are there so few people with `middle' incomes?"</span>,
       x <span class="op">=</span> <span class="st">"Income"</span>,
       y <span class="op">=</span> <span class="st">"Count"</span>,
       caption <span class="op">=</span> <span class="st">"Data source: Enos (2014)"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-64-1.png" width="100%"></div>
<p>Unlike scatterplots and linegraphs, there is now only one variable being mapped in <code>aes()</code>. Here, that variable is <code>income</code>. The y-aesthetic of a histogram, the count of the observations in each bin, gets computed for you automatically. Furthermore, the geometric object layer is now a <code>geom_histogram()</code>.</p>
<p>We can use the <code>fill</code> argument to change the color of the actual bins. Let’s set <code>fill</code> to “steelblue.”</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">trains</span>, 
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">income</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">50</span>,
                 fill <span class="op">=</span> <span class="st">"steelblue"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Income Among Boston Commuter"</span>,
       subtitle <span class="op">=</span> <span class="st">"Why are there so few people with `middle' incomes?"</span>,
       x <span class="op">=</span> <span class="st">"Income"</span>,
       y <span class="op">=</span> <span class="st">"Count"</span>,
       caption <span class="op">=</span> <span class="st">"Data source: Enos (2014)"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-65-1.png" width="100%"></div>
<p>We can also adjust the number of bins in our histogram in one of two ways:</p>
<ol style="list-style-type: decimal">
<li><p>By adjusting the number of bins via the <code>bins</code> argument to <code>geom_histogram()</code>.</p></li>
<li><p>By adjusting the width of the bins via the <code>binwidth</code> argument to <code>geom_histogram()</code>.</p></li>
</ol>
<p>In this data, however, there are not many unique values for <code>income</code>, so neither approach will have much effect. Replace <code>income</code> with <code>age</code> if you want to experiment with these options.</p>
</div>
<div id="geom_bar" class="section level3" number="1.3.5">
<h3>
<span class="header-section-number">1.3.5</span> <code>geom_bar()</code><a class="anchor" aria-label="anchor" href="#geom_bar"><i class="fas fa-link"></i></a>
</h3>
<p><code>geom_bar()</code> visualizes the distribution of a categorical variable. This is a simpler task than creating a histogram, as we are simply counting different categories within a categorical variable, also known as the <em>levels</em> of the categorical variable. Often the best way to visualize these different counts, also known as <em>frequencies</em>, is with a barplot.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">trains</span>, 
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">race</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-66-1.png" width="100%"></div>
<div id="two-categorical-variables" class="section level4" number="1.3.5.1">
<h4>
<span class="header-section-number">1.3.5.1</span> Two categorical variables<a class="anchor" aria-label="anchor" href="#two-categorical-variables"><i class="fas fa-link"></i></a>
</h4>
<p>Another use of barplots is to visualize the <em>joint</em> distribution of two categorical variables. (See Chapter <a href="probability.html#probability">5</a> for the definition of a joint distribution.) Let’s look at <code>race</code>, as well as <code>treatment</code>, in the <code>trains</code> data by using the <code>fill</code> argument inside the <code>aes()</code> aesthetic mapping. Recall the <code>fill</code> aesthetic corresponds to the color used to fill the bars.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">trains</span>, 
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">race</span>, fill <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-67-1.png" width="100%"></div>
<p>This is an example of a <em>stacked barplot</em>. While simple to make, in certain aspects it is not ideal. For example, it is difficult to compare the heights of the different colors between the bars, corresponding to comparing the number of people of different races within each region.</p>
<p>An alternative to stacked barplots are <em>side-by-side barplots</em>, also known as <em>dodged barplots</em>. The code to create a side-by-side barplot includes a <code>position = "dodge"</code> argument added inside <code>geom_bar()</code>. In other words, we are overriding the default barplot type, which is a <em>stacked</em> barplot, and specifying it to be a side-by-side barplot instead.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">trains</span>, 
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">race</span>, fill <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-68-1.png" width="100%"></div>
<p>Whites are over-represented in the Control group even though the <code>treatment</code> was assigned at random.</p>
</div>
</div>
<div id="geom_col" class="section level3" number="1.3.6">
<h3>
<span class="header-section-number">1.3.6</span> <code>geom_col()</code><a class="anchor" aria-label="anchor" href="#geom_col"><i class="fas fa-link"></i></a>
</h3>
<p><code>geom_col()</code> is similar to <code>geom_bar()</code>, except that <code>geom_col()</code> requires you to calculate the number of observations in each category ahead of time. <code>geom_bar()</code> does the calculation for you. See an example below.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">race</span>,<span class="va">treatment</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarize</span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">race</span>,
                       y <span class="op">=</span> <span class="va">count</span>,
                       fill <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu">geom_col</span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'race'. You can override using the `.groups` argument.</code></pre>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-69-1.png" width="100%"></div>
<p>You will learn to filter the data later in this chapter. However, what is key here is there was a y-variable supplied in <code>geom_col()</code> but there was not in <code>geom_bar()</code>. <code>geom_col()</code> gives you more control over the data that is being presented compared to <code>geom_bar()</code>, which may come in useful in some circumstances.</p>
<div id="no-pie-charts" class="section level4" number="1.3.6.1">
<h4>
<span class="header-section-number">1.3.6.1</span> No pie charts!<a class="anchor" aria-label="anchor" href="#no-pie-charts"><i class="fas fa-link"></i></a>
</h4>
<p>One of the most common plots used to visualize the distribution of categorical data is the pie chart. While they may seem harmless enough, pie charts actually present a problem in that humans are unable to judge angles well. <span class="citation"><a href="references.html#ref-robbins2013" role="doc-biblioref">Robbins</a> (<a href="references.html#ref-robbins2013" role="doc-biblioref">2013</a>)</span> argues that we overestimate angles greater than 90 degrees and we underestimate angles less than 90 degrees. In other words, it is difficult for us to determine the relative size of one piece of the pie compared to another. <em>Do not use pie charts.</em></p>
</div>
</div>
<div id="geom_smooth" class="section level3" number="1.3.7">
<h3>
<span class="header-section-number">1.3.7</span> <code>geom_smooth()</code><a class="anchor" aria-label="anchor" href="#geom_smooth"><i class="fas fa-link"></i></a>
</h3>
<p>We can add trend lines to the plots we create using the <code>geom_smooth()</code> function.</p>
<!-- DK: Will handle geom_smooth().explain method, se, and formula -->
<p>Recall the following scatterplot from our previous work.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">trains</span>, 
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">att_start</span>, 
           y <span class="op">=</span> <span class="va">att_end</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Immigration Attitudes Among Boston Commuters"</span>,
       subtitle <span class="op">=</span> <span class="st">"Attitudes did not change much after the experiment"</span>,
       x <span class="op">=</span> <span class="st">"Attitude Before Experiment"</span>,
       y <span class="op">=</span> <span class="st">"Attitude After Experiment"</span>,
       caption <span class="op">=</span> <span class="st">"Data source: Enos (2014)"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-70-1.png" width="100%"></div>
<p>We can add a trend line to our graph by adding the layer <code>geom_smooth()</code>. Including trend lines allow us to visualize the relationship between <code>att_start</code> and <code>att_end</code>.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">trains</span>, 
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">att_start</span>, 
           y <span class="op">=</span> <span class="va">att_end</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Immigration Attitudes Among Boston Commuters"</span>,
       subtitle <span class="op">=</span> <span class="st">"Attitudes did not change much after the experiment"</span>,
       x <span class="op">=</span> <span class="st">"Attitude Before Experiment"</span>,
       y <span class="op">=</span> <span class="st">"Attitude After Experiment"</span>,
       caption <span class="op">=</span> <span class="st">"Data source: Enos (2014)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_smooth</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'loess' and formula 'y ~ x'</code></pre>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-71-1.png" width="100%"></div>
<p>Note the message. R is telling us that we need to specify the <code>method</code> and <code>formula</code> argument, just the way it told us to provide the <code>bins</code> argument when we used <code>geom_histogram()</code> before.</p>
<p>Let’s add the argument <code>method = "lm"</code>, where “lm” stands for <strong>l</strong>inear <strong>m</strong>odel. This causes the fitted line to be straight rather than curved. Let’s also add the argument <code>formula = y ~ x</code>. This makes both messages go away. Again, R was not giving us an error before. It was simply telling us what options it was using since we did not specify the options ourselves.</p>
<!-- HL: should we explain why we make the argument formula = y~x? The reason is that R is concerned that we don't know exactly what model it is estimating. So, it is warning us that y is function of x. We make the warning go away by specifying that relationship in the argument. -->
<p><em>Always include enough detail in your code to make those messages disappear.</em></p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">trains</span>, 
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">att_start</span>, 
           y <span class="op">=</span> <span class="va">att_end</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Immigration Attitudes Among Boston Commuters"</span>,
       subtitle <span class="op">=</span> <span class="st">"Attitudes did not change much after the experiment"</span>,
       x <span class="op">=</span> <span class="st">"Attitude Before Experiment"</span>,
       y <span class="op">=</span> <span class="st">"Attitude After Experiment"</span>,
       caption <span class="op">=</span> <span class="st">"Data source: Enos (2014)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, 
              formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-72-1.png" width="100%"></div>
<p>Notice the gray section surrounding the line we plotted. This area is called the confidence interval, which is set to 95% by default. We will learn about confidence intervals in Chapter <a href="probability.html#probability">5</a>. You can make the shaded are disappear by adding <code>se = FALSE</code> as another argument to <code>geom_smooth()</code>.</p>
</div>
<div id="geom_density" class="section level3" number="1.3.8">
<h3>
<span class="header-section-number">1.3.8</span> <code>geom_density()</code><a class="anchor" aria-label="anchor" href="#geom_density"><i class="fas fa-link"></i></a>
</h3>
<p>Recall our plot from the <code>geom_histogram()</code> section.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">trains</span>, 
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">income</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Income Among Boston Commuter"</span>,
       subtitle <span class="op">=</span> <span class="st">"Why are there so few people with `middle' incomes?"</span>,
       x <span class="op">=</span> <span class="st">"Income"</span>,
       y <span class="op">=</span> <span class="st">"Count"</span>,
       caption <span class="op">=</span> <span class="st">"Data source: Enos (2014)"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-73-1.png" width="100%"></div>
<p>Change <code>geom_histogram()</code> to <code>geom_density()</code> to make a density plot, which is a smoothed version of the histogram.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">trains</span>, 
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">income</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Income Among Boston Commuter"</span>,
       subtitle <span class="op">=</span> <span class="st">"Why are there so few people with `middle' incomes?"</span>,
       x <span class="op">=</span> <span class="st">"Income"</span>,
       y <span class="op">=</span> <span class="cn">NULL</span>,
       caption <span class="op">=</span> <span class="st">"Data source: Enos (2014)"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-74-1.png" width="100%"></div>
<p>The values on the y-axis are scaled so that the total area under the curve equals one.</p>
<!-- DK: Other stuff to finish this section with? -->
<!-- HL: could we just list other uncommonly used geom functions that people have the option of using if they want to and point them to another resource that they can learn from if they want? Yes!  -->
</div>
</div>
<div id="tidyverse" class="section level2" number="1.4">
<h2>
<span class="header-section-number">1.4</span> Tidyverse<a class="anchor" aria-label="anchor" href="#tidyverse"><i class="fas fa-link"></i></a>
</h2>
<p>Going forward, most <code>ggplot()</code> code will omit the <code>data =</code> and <code>mapping =</code> explicit naming of arguments while relying on the default ordering. Most of the time, we include argument names and, as a rule, you should to. But we create so many plots in <em>The Primer</em> that these omissions are unlikely to cause problems.</p>
<div id="data-wrangling" class="section level3" number="1.4.1">
<h3>
<span class="header-section-number">1.4.1</span> Data wrangling<a class="anchor" aria-label="anchor" href="#data-wrangling"><i class="fas fa-link"></i></a>
</h3>
<p>We can’t use all the beautiful plots that we learned in the previous chapter until we have “wrangled” the data into a convenient shape. Key wrangling functions include:</p>
<ul>
<li><p><code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code>: to pick out the <em>rows</em> we want to keep from a tibble.</p></li>
<li><p><code>select()</code>: to pick out the <em>columns</em> we want to keep from a tibble.</p></li>
<li><p><code>arrange()</code>: to sort the rows in a tibble, in either ascending or descending order.</p></li>
<li><p><code>mutate()</code>: to create new columns.</p></li>
<li><p><code>group_by()</code>: to assign each row in a tibble to a “group.” This allows statistics to be calculated for each group <em>separately</em>. You will usually use <code>group_by()</code> with <code>summarize()</code>.</p></li>
<li><p><code>summarize()</code>: to create a new tibble comprised of summary statistics for one (or more) rows for each grouped variable, or for the tibble as a whole if it is ungrouped.</p></li>
</ul>
</div>
<div id="the-pipe-operator" class="section level3" number="1.4.2">
<h3>
<span class="header-section-number">1.4.2</span> The pipe operator: <code>%&gt;%</code><a class="anchor" aria-label="anchor" href="#the-pipe-operator"><i class="fas fa-link"></i></a>
</h3>
<p>The pipe operator (<code>%&gt;%</code>) allows us to combine multiple operations in R into a single sequential <em>chain</em> of actions. Much like how the <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> sign has to come at the end of the line when constructing plots — because we are building the plot layer-by-layer — the pipe operator <code>%&gt;%</code> has to come at the end of the line because we are building a data wrangling pipeline step-by-step. If you do not include the pipe operator, R assumes the next line of code is unrelated to the layers you built and you will get an error.</p>
</div>
<div id="filter-rows" class="section level3" number="1.4.3">
<h3>
<span class="header-section-number">1.4.3</span> <code>filter()</code> rows<a class="anchor" aria-label="anchor" href="#filter-rows"><i class="fas fa-link"></i></a>
</h3>
<div class="figure">
<span id="fig:unnamed-chunk-75"></span>
<img src="01-visualization/images/filter.png" alt="filter() reduces the rows in a tibble." width="100%"><p class="caption">
FIGURE 1.1: filter() reduces the rows in a tibble.
</p>
</div>
<p>The <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> function works much like the “Filter” option in Microsoft Excel. It allows you to specify criteria about the values of a variable in your dataset and then selects only the rows that match that criteria.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"Male"</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 64 x 14
##    treatment att_start att_end gender race  liberal party     age income line   
##    &lt;fct&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;lgl&gt;   &lt;chr&gt;   &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;  
##  1 Treated           3       5 Male   White TRUE    Democr…    63 135000 Framin…
##  2 Treated          11      11 Male   White FALSE   Democr…    45 300000 Framin…
##  3 Control           8       5 Male   White TRUE    Democr…    55 135000 Framin…
##  4 Treated          10      11 Male   White FALSE   Democr…    36 135000 Framin…
##  5 Treated           9      10 Male   White FALSE   Republ…    42 135000 Framin…
##  6 Treated          11       9 Male   White FALSE   Democr…    50 250000 Framin…
##  7 Treated          13      13 Male   White FALSE   Republ…    24 105000 Framin…
##  8 Control           6       7 Male   White TRUE    Democr…    40  62500 Framin…
##  9 Control           8       8 Male   White TRUE    Democr…    53 300000 Framin…
## 10 Treated          13      13 Male   Asian FALSE   Republ…    33 250000 Framin…
## # … with 54 more rows, and 4 more variables: station &lt;chr&gt;, hisp_perc &lt;dbl&gt;,
## #   ideology_start &lt;int&gt;, ideology_end &lt;int&gt;</code></pre>
<p>The result of using <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> will be a tibble with just the rows that you want. When we alter our data, it can be a good idea to save the result in a new data frame by using the <code><a href="https://rdrr.io/r/base/assignOps.html">&lt;-</a></code> assignment operator.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains_men</span> <span class="op">&lt;-</span> <span class="va">trains</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"Male"</span><span class="op">)</span></code></pre></div>
<p>Let’s break down the code. We assigned our new data to an object named <code>trains_men</code> via <code>trains_men &lt;-</code>. Because we assigned this modified data frame to <code>trains_men</code>, it is a separate entity from the initial <code>trains</code> data frame. If, however, we had written the code as <code>trains &lt;- trains</code> we would have overwritten the already-existing tibble.</p>
<p>We start with the <code>trains</code> tibble and <em>then</em> <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> so that only those observations where the <code>gender</code> equals “Male” are included. We test for equality using the double equal sign <code><a href="https://rdrr.io/r/base/Comparison.html">==</a></code> and not a single equal sign <code><a href="https://rdrr.io/r/base/assignOps.html">=</a></code>. In other words, <code><a href="https://rdrr.io/r/stats/filter.html">filter(gender = "Male")</a></code> will produce an error. This is a convention across many programming languages.</p>
<p>You can use other operators beyond just the <code><a href="https://rdrr.io/r/base/Comparison.html">==</a></code> operator.</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/Comparison.html">&gt;</a></code> for “greater than”</li>
<li>
<code><a href="https://rdrr.io/r/base/Comparison.html">&lt;</a></code> for “less than”</li>
<li>
<code><a href="https://rdrr.io/r/base/Comparison.html">&gt;=</a></code> for “greater than or equal to”</li>
<li>
<code><a href="https://rdrr.io/r/base/Comparison.html">&lt;=</a></code> for “less than or equal to”</li>
<li>
<code><a href="https://rdrr.io/r/base/Comparison.html">!=</a></code> for “not equal to.” The <code><a href="https://rdrr.io/r/base/Logic.html">!</a></code> indicates “not.”</li>
</ul>
<p>Furthermore, you can combine multiple criteria using operators that make comparisons:</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/Logic.html">|</a></code> for “or”</li>
<li>
<code><a href="https://rdrr.io/r/base/Logic.html">&amp;</a></code> for “and”</li>
</ul>
<p>For example, let’s <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> the <code>trains</code> tibble to include only women who are Republicans and younger than 40.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"Female"</span> <span class="op">&amp;</span> 
           <span class="va">party</span> <span class="op">==</span> <span class="st">"Republican"</span> <span class="op">&amp;</span>
           <span class="va">age</span> <span class="op">&lt;</span> <span class="fl">40</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 14
##   treatment att_start att_end gender race  liberal party      age income line   
##   &lt;fct&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;lgl&gt;   &lt;chr&gt;    &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;  
## 1 Treated           9      10 Female White FALSE   Republi…    34 105000 Framin…
## 2 Control          11      10 Female White FALSE   Republi…    21 135000 Frankl…
## 3 Control          15      12 Female White FALSE   Republi…    21 250000 Frankl…
## # … with 4 more variables: station &lt;chr&gt;, hisp_perc &lt;dbl&gt;,
## #   ideology_start &lt;int&gt;, ideology_end &lt;int&gt;</code></pre>
<p>Instead of creating a single criterion with many parts, like with an <code><a href="https://rdrr.io/r/base/Logic.html">&amp;</a></code>, you can just separate the parts with a comma. The resulting tibble is the same.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"Female"</span>,
         <span class="va">party</span> <span class="op">==</span> <span class="st">"Republican"</span>,
         <span class="va">age</span> <span class="op">&lt;</span> <span class="fl">40</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 14
##   treatment att_start att_end gender race  liberal party      age income line   
##   &lt;fct&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;lgl&gt;   &lt;chr&gt;    &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;  
## 1 Treated           9      10 Female White FALSE   Republi…    34 105000 Framin…
## 2 Control          11      10 Female White FALSE   Republi…    21 135000 Frankl…
## 3 Control          15      12 Female White FALSE   Republi…    21 250000 Frankl…
## # … with 4 more variables: station &lt;chr&gt;, hisp_perc &lt;dbl&gt;,
## #   ideology_start &lt;int&gt;, ideology_end &lt;int&gt;</code></pre>
<!-- DK: More examples? -->
</div>
<div id="select-variables" class="section level3" number="1.4.4">
<h3>
<span class="header-section-number">1.4.4</span> <code>select</code> variables<a class="anchor" aria-label="anchor" href="#select-variables"><i class="fas fa-link"></i></a>
</h3>
<div class="figure">
<span id="fig:unnamed-chunk-80"></span>
<img src="01-visualization/images/select.png" alt="select() reduces the number of columns in a tibble." width="100%"><p class="caption">
FIGURE 1.2: select() reduces the number of columns in a tibble.
</p>
</div>
<p>Using the <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> function we were able to pick out specific <em>rows</em> (observations) from the tibble. The <code>select()</code> function allows us to pick specific <em>columns</em> (variables) instead.</p>
<p>Use <code>glimpse()</code> to see the names of the variables in <code>trains</code>:</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">glimpse</span><span class="op">(</span><span class="va">trains</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 115
## Columns: 14
## $ treatment      &lt;fct&gt; Treated, Treated, Treated, Treated, Control, Treated, C…
## $ att_start      &lt;dbl&gt; 11, 9, 3, 11, 8, 13, 13, 10, 12, 9, 10, 11, 13, 6, 8, 1…
## $ att_end        &lt;dbl&gt; 11, 10, 5, 11, 5, 13, 13, 11, 12, 10, 9, 9, 13, 7, 8, 1…
## $ gender         &lt;chr&gt; "Female", "Female", "Male", "Male", "Male", "Female", "…
## $ race           &lt;chr&gt; "White", "White", "White", "White", "White", "White", "…
## $ liberal        &lt;lgl&gt; FALSE, FALSE, TRUE, FALSE, TRUE, FALSE, FALSE, FALSE, F…
## $ party          &lt;chr&gt; "Democrat", "Republican", "Democrat", "Democrat", "Demo…
## $ age            &lt;int&gt; 31, 34, 63, 45, 55, 37, 53, 36, 54, 42, 33, 50, 24, 40,…
## $ income         &lt;dbl&gt; 135000, 105000, 135000, 300000, 135000, 87500, 87500, 1…
## $ line           &lt;chr&gt; "Framingham", "Framingham", "Framingham", "Framingham",…
## $ station        &lt;chr&gt; "Grafton", "Southborough", "Grafton", "Grafton", "Graft…
## $ hisp_perc      &lt;dbl&gt; 0.026, 0.015, 0.019, 0.019, 0.019, 0.023, 0.030, 0.025,…
## $ ideology_start &lt;int&gt; 3, 4, 1, 4, 2, 5, 5, 4, 4, 4, 3, 5, 4, 1, 2, 2, 3, 4, 2…
## $ ideology_end   &lt;int&gt; 3, 4, 2, 4, 2, 5, 5, 4, 3, 4, 3, 4, 4, 1, 2, 3, 3, 1, 2…</code></pre>
<p>However, if you only need two of these variables, say <code>gender</code> and <code>treatment</code>. You can <code>select()</code> just these two:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">gender</span>, <span class="va">treatment</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 115 x 2
##    gender treatment
##    &lt;chr&gt;  &lt;fct&gt;    
##  1 Female Treated  
##  2 Female Treated  
##  3 Male   Treated  
##  4 Male   Treated  
##  5 Male   Control  
##  6 Female Treated  
##  7 Female Control  
##  8 Male   Treated  
##  9 Female Control  
## 10 Male   Treated  
## # … with 105 more rows</code></pre>
<p>You can drop, or “de-select,” certain variables by using the minus (<code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code>) sign:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">gender</span>, <span class="op">-</span><span class="va">liberal</span>, <span class="op">-</span><span class="va">party</span>, <span class="op">-</span><span class="va">age</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 115 x 10
##    treatment att_start att_end race  income line       station      hisp_perc
##    &lt;fct&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;            &lt;dbl&gt;
##  1 Treated          11      11 White 135000 Framingham Grafton         0.0264
##  2 Treated           9      10 White 105000 Framingham Southborough    0.0154
##  3 Treated           3       5 White 135000 Framingham Grafton         0.0191
##  4 Treated          11      11 White 300000 Framingham Grafton         0.0191
##  5 Control           8       5 White 135000 Framingham Grafton         0.0191
##  6 Treated          13      13 White  87500 Framingham Grafton         0.0231
##  7 Control          13      13 White  87500 Framingham Grafton         0.0304
##  8 Treated          10      11 White 135000 Framingham Grafton         0.0247
##  9 Control          12      12 White 105000 Framingham Grafton         0.0247
## 10 Treated           9      10 White 135000 Framingham Grafton         0.0259
## # … with 105 more rows, and 2 more variables: ideology_start &lt;int&gt;,
## #   ideology_end &lt;int&gt;</code></pre>
<p>You can specify a range of columns by using the <code><a href="https://rdrr.io/r/base/Colon.html">:</a></code> operator.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">gender</span><span class="op">:</span><span class="va">age</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 115 x 5
##    gender race  liberal party        age
##    &lt;chr&gt;  &lt;chr&gt; &lt;lgl&gt;   &lt;chr&gt;      &lt;int&gt;
##  1 Female White FALSE   Democrat      31
##  2 Female White FALSE   Republican    34
##  3 Male   White TRUE    Democrat      63
##  4 Male   White FALSE   Democrat      45
##  5 Male   White TRUE    Democrat      55
##  6 Female White FALSE   Democrat      37
##  7 Female White FALSE   Republican    53
##  8 Male   White FALSE   Democrat      36
##  9 Female White FALSE   Democrat      54
## 10 Male   White FALSE   Republican    42
## # … with 105 more rows</code></pre>
<p>This will <code>select()</code> all columns between the two specified variables.
The <code>select()</code> function can also be used to rearrange columns when used with the <code>everything()</code> helper function. We can put the <code>treatment</code> and <code>gender</code> variables first with:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">treatment</span>, <span class="va">gender</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 115 x 14
##    treatment gender att_start att_end race  liberal party     age income line   
##    &lt;fct&gt;     &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;lgl&gt;   &lt;chr&gt;   &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;  
##  1 Treated   Female        11      11 White FALSE   Democr…    31 135000 Framin…
##  2 Treated   Female         9      10 White FALSE   Republ…    34 105000 Framin…
##  3 Treated   Male           3       5 White TRUE    Democr…    63 135000 Framin…
##  4 Treated   Male          11      11 White FALSE   Democr…    45 300000 Framin…
##  5 Control   Male           8       5 White TRUE    Democr…    55 135000 Framin…
##  6 Treated   Female        13      13 White FALSE   Democr…    37  87500 Framin…
##  7 Control   Female        13      13 White FALSE   Republ…    53  87500 Framin…
##  8 Treated   Male          10      11 White FALSE   Democr…    36 135000 Framin…
##  9 Control   Female        12      12 White FALSE   Democr…    54 105000 Framin…
## 10 Treated   Male           9      10 White FALSE   Republ…    42 135000 Framin…
## # … with 105 more rows, and 4 more variables: station &lt;chr&gt;, hisp_perc &lt;dbl&gt;,
## #   ideology_start &lt;int&gt;, ideology_end &lt;int&gt;</code></pre>
<p>The helper functions <code>starts_with()</code>, <code>ends_with()</code>, and <code>contains()</code> can be used to select variables/columns that match those conditions. Examples:</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"a"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 115 x 3
##    att_start att_end   age
##        &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;
##  1        11      11    31
##  2         9      10    34
##  3         3       5    63
##  4        11      11    45
##  5         8       5    55
##  6        13      13    37
##  7        13      13    53
##  8        10      11    36
##  9        12      12    54
## 10         9      10    42
## # … with 105 more rows</code></pre>
</div>
<div id="slice-and-pull-and" class="section level3" number="1.4.5">
<h3>
<span class="header-section-number">1.4.5</span> <code>slice()</code> and <code>pull()</code> and <code>[]</code><a class="anchor" aria-label="anchor" href="#slice-and-pull-and"><i class="fas fa-link"></i></a>
</h3>
<p><code>slice()</code> and <code>pull()</code> are additional functions that you can use to pick out specific rows or columns within a data frame.</p>
<p>Using <code>slice()</code> gives us specific rows from the <code>trains</code> tibble:</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains</span> <span class="op">%&gt;%</span> 
  <span class="fu">slice</span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 14
##   treatment att_start att_end gender race  liberal party      age income line   
##   &lt;fct&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;lgl&gt;   &lt;chr&gt;    &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;  
## 1 Treated           9      10 Female White FALSE   Republi…    34 105000 Framin…
## 2 Treated           3       5 Male   White TRUE    Democrat    63 135000 Framin…
## 3 Treated          11      11 Male   White FALSE   Democrat    45 300000 Framin…
## 4 Control           8       5 Male   White TRUE    Democrat    55 135000 Framin…
## # … with 4 more variables: station &lt;chr&gt;, hisp_perc &lt;dbl&gt;,
## #   ideology_start &lt;int&gt;, ideology_end &lt;int&gt;</code></pre>
<p>Unlike <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code>, <code>slice()</code> relies on numeric order of the data.</p>
<p><code>pull()</code> grabs out a variable as a vector, rather than leaving it within a tibble, as <code>select()</code> does:</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains</span> <span class="op">%&gt;%</span> 
  <span class="fu">slice</span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pull</span><span class="op">(</span><span class="va">age</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 34 63 45 55</code></pre>
</div>
<div id="arrange" class="section level3" number="1.4.6">
<h3>
<span class="header-section-number">1.4.6</span> <code>arrange()</code><a class="anchor" aria-label="anchor" href="#arrange"><i class="fas fa-link"></i></a>
</h3>
<!-- DK: Where is the graphic? -->
<p><code>arrange()</code> allows us to sort/reorder a tibble’s rows according to the values of a specific variable. Unlike <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> or <code>select()</code>, <code>arrange()</code> does not remove any rows or columns from the tibble. Example:</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">treatment</span>, <span class="va">gender</span>, <span class="va">age</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">arrange</span><span class="op">(</span><span class="va">age</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 115 x 3
##    treatment gender   age
##    &lt;fct&gt;     &lt;chr&gt;  &lt;int&gt;
##  1 Treated   Female    20
##  2 Control   Male      20
##  3 Control   Male      21
##  4 Control   Female    21
##  5 Control   Female    21
##  6 Control   Male      22
##  7 Control   Female    22
##  8 Treated   Male      22
##  9 Treated   Male      23
## 10 Control   Male      23
## # … with 105 more rows</code></pre>
<p><code>arrange()</code> always returns rows sorted in ascending order by default. To switch the ordering to descending order instead, use the <code>desc()</code> function:</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">treatment</span>, <span class="va">gender</span>, <span class="va">age</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 115 x 3
##    treatment gender   age
##    &lt;fct&gt;     &lt;chr&gt;  &lt;int&gt;
##  1 Control   Female    68
##  2 Control   Male      68
##  3 Control   Male      67
##  4 Treated   Male      63
##  5 Control   Male      63
##  6 Control   Male      61
##  7 Control   Female    60
##  8 Treated   Male      60
##  9 Control   Male      60
## 10 Control   Female    60
## # … with 105 more rows</code></pre>
<p>This is the first of many “pipes” which we will create in <em>The Primer</em>. First, we have the <code>trains</code> tibble. Second, we pipe that to the <code>select()</code> function. Third, we pipe the results of <code>select()</code> to the <code>arrange()</code> function. <em>Each step in the pipe starts with a tibble and then, once it is done, produces a tibble. It is tibbles all the way down!</em></p>
<!-- DK: Need a graphic of turtle tibbles stacked on each other. -->
</div>
<div id="mutate" class="section level3" number="1.4.7">
<h3>
<span class="header-section-number">1.4.7</span> <code>mutate()</code><a class="anchor" aria-label="anchor" href="#mutate"><i class="fas fa-link"></i></a>
</h3>
<div class="figure">
<span id="fig:unnamed-chunk-91"></span>
<img src="01-visualization/images/mutate.png" alt="`mutate() adds a column to a tibble." width="100%"><p class="caption">
FIGURE 1.3: `mutate() adds a column to a tibble.
</p>
</div>
<p><code>mutate()</code> takes existing columns and creates a new column. Recall that the <code>income</code> variable in the <code>trains</code> tibble is in dollars. Let’s use <code>mutate()</code> to create a new variable which is income in thousands of dollars. (We use <code>select()</code> at the start of the pipe so that it is easier to see the new and old variables at the same time.)</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">gender</span>, <span class="va">income</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>income_in_thousands <span class="op">=</span> <span class="va">income</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 115 x 3
##    gender income income_in_thousands
##    &lt;chr&gt;   &lt;dbl&gt;               &lt;dbl&gt;
##  1 Female 135000               135  
##  2 Female 105000               105  
##  3 Male   135000               135  
##  4 Male   300000               300  
##  5 Male   135000               135  
##  6 Female  87500                87.5
##  7 Female  87500                87.5
##  8 Male   135000               135  
##  9 Female 105000               105  
## 10 Male   135000               135  
## # … with 105 more rows</code></pre>
<p>Notice that we have a newly created column at the right-hand side of our tibble named <code>income_in_thousands</code>.</p>
<p>When creating new variables we can also <em>overwrite</em> the original tibble:</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains</span> <span class="op">&lt;-</span> <span class="va">trains</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>income_in_thousands <span class="op">=</span> <span class="op">(</span><span class="va">income</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span></code></pre></div>
<!-- DK: Awk -->
<p>Whenever we create a new tibble, or a new variable within a tibble, we face a dilemma: Should we overwrite the existing tibble/variable or create a new one? There is no right answer.</p>
<p>For example, instead of overwriting <code>trains</code> in the code above, we could have created a new tibble <code>trains_new</code>. Similarly, instead of creating a new variable, <code>income_in_thousands</code>, we could have overwritten the current value of <code>income</code>. Use your best judgment and be careful.</p>
<div id="if_else" class="section level4" number="1.4.7.1">
<h4>
<span class="header-section-number">1.4.7.1</span> <code>if_else()</code><a class="anchor" aria-label="anchor" href="#if_else"><i class="fas fa-link"></i></a>
</h4>
<!-- DK: Edit these lines from R4DS. Are there other functions which we should mention here? Do something sensible with group_by. To get `_` to work in caption title. Found at https://github.com/rstudio/bookdown/issues/209  -->
<p><code>if_else()</code> is often used within calls to <code>mutate()</code>. It has three arguments. The first argument <code>test</code> should be a logical vector. The result will contain the value of the second argument, <code>yes</code>, when test is TRUE, and the value of the third argument, <code>no</code>, when it is FALSE.</p>
<p>Imagine that we want to create a new variable <code>old</code>, which is TRUE when <code>age &gt; 50</code> and FALSE otherwise.</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>old <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">age</span> <span class="op">&gt;</span> <span class="fl">50</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 115 x 2
##      age old  
##    &lt;int&gt; &lt;lgl&gt;
##  1    31 FALSE
##  2    34 FALSE
##  3    63 TRUE 
##  4    45 FALSE
##  5    55 TRUE 
##  6    37 FALSE
##  7    53 TRUE 
##  8    36 FALSE
##  9    54 TRUE 
## 10    42 FALSE
## # … with 105 more rows</code></pre>
<p>Another function similar to <code>if_else()</code>, is <code><a href="https://dplyr.tidyverse.org/reference/case_when.html">dplyr::case_when()</a></code>. <code>case_when()</code> is particularly useful inside mutate when you want to create a new variable that relies on a complex combination of existing variables. Note that there is a different version of <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> in <strong>dplyr</strong>: <code>if_else()</code>. This works exactly the same as the standard version but is somewhat more robust.</p>
<!-- DK: More details? -->
</div>
</div>
<div id="summarize" class="section level3" number="1.4.8">
<h3>
<span class="header-section-number">1.4.8</span> <code>summarize()</code><a class="anchor" aria-label="anchor" href="#summarize"><i class="fas fa-link"></i></a>
</h3>
<p>A musical interlude inspired by the Tidyverse:</p>
<iframe src="https://www.youtube.com/embed/p8Py9C8iq2s?showcase=0" width="100%" height="400px">
</iframe>
<p>We often need to calculate <em>summary statistics</em>, things like the <em>mean</em> (also called the average) and the <em>median</em> (the middle value). Other examples of summary statistics include the <em>sum</em>, the <em>minimum</em>, the <em>maximum</em>, and the <em>standard deviation</em>.</p>
<p>The function <code>summarize()</code> allows us to calculate these statistics on individual columns from a tibble. Example:</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarize</span><span class="op">(</span>mn_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, 
            sd_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   mn_age sd_age
##    &lt;dbl&gt;  &lt;dbl&gt;
## 1   42.4   12.2</code></pre>
<p>The <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> and <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code> summary functions go inside the <code>summarize()</code> function. The <code>summarize()</code> function takes in a tibble and returns a tibbles with only one row corresponding to the summary statistics. Remember: Tibbles go in and tibble come out.</p>
<p><strong><code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code></strong></p>
<p>The mean, or average, is the most commonly reported measure of the center of a distribution. The mean is the sum of all of the data elements divided by the number of elements. If we have <span class="math inline">\(N\)</span> data points, the mean is given by:</p>
<p><span class="math display">\[\bar{x} = \frac{x_1 + x_2 + \cdots + x_N}{N}\]</span></p>
<p><strong><code><a href="https://rdrr.io/r/stats/median.html">median()</a></code></strong></p>
<p>The median is another commonly reported measure of the center of a distribution, calculated by first sorting the vector of values from smallest to largest. The middle element in the sorted list is the <em>median</em>. If the middle falls between two values, then the median is the mean of those two middle values. The median and the mean are the two most common measures of the <em>center</em> of a distribution. The median is more stable, less affected by outliers. There is no widely accepted symbol for the median, although <span class="math inline">\(\tilde{x}\)</span> is not uncommon.</p>
<p><strong><code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code></strong></p>
<p>The standard deviation (<em>sd</em>) of a distribution is a measure of its variation around the mean.</p>
<p><span class="math display">\[\text{sd} = \sqrt{\frac{(x_1 - \bar{x})^2 + (x_2 - \bar{x})^2 + \cdots + (x_n - \bar{x})^2}{n - 1}}\]</span></p>
<!-- DK: More detail. How much does it cover? Plot a not-too-weirdish distribution and show two sd's on it. -->
<p><strong><code><a href="https://rdrr.io/r/stats/mad.html">mad()</a></code></strong></p>
<p>The scaled median absolute deviation (<em>mad</em>) is a measure of variation around the median. It is not as popular as the standard deviation. The formula for calculating <em>mad</em> is a bit mysterious.</p>
<p><span class="math display">\[\text{mad} = 1.4826 \times \text{median}(abs(x - \tilde{x}))\]</span></p>
<p>The basic idea for both <em>sd</em> and <em>mad</em> is that we need a measure of variation around the center of the distribution of the variable. <em>sd</em> uses the mean, <span class="math inline">\(\bar{x}\)</span>, as its estimate of the center while <em>mad</em> uses the median, <span class="math inline">\(\tilde{x}\)</span>. Because <em>mad</em> uses the absolute difference, as opposed to the squared difference, it is more robust to outliers. The 1.4826 multiplier causes the <em>mad</em> and the <em>sd</em> to be identical in the (important) case of standard normal distributions, a topic we will introduce in Chapter <a href="wrangling.html#wrangling">2</a>.</p>
<p><strong><code><a href="https://rdrr.io/r/stats/quantile.html">quantile()</a></code></strong></p>
<p>The <em>quantile</em> of a distribution is the value of that distribution which occupies a specific percentile location in the sorted list of values.</p>
<p>The 5th percentile distribution is the point below which 5% of the data falls. The 95th percentile is, similarly, the point below which 95% of the data falls. The 50th percentile, the median, splits the data into two separate, and equal, parts. The minimum is at the 0th percentile. The maximum is at the 100th percentile.</p>
<!-- HL: it's kinda unclear what the relationship between this paragraph and quantiles is? Also I sort of think the definition of quantile is rather wordy and not super clear. So fix it! -->
<p>Let’s take a look at the <code>poverty</code> variable in the <code>kenya</code> tibble from the <strong>primer.data</strong> package. <code>poverty</code> is the percentage of residents in each community with incomes below the poverty line. Let’s first confirm that <code><a href="https://rdrr.io/r/stats/quantile.html">quantile()</a></code> works by comparing its output with that from simpler functions.</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">kenya</span><span class="op">$</span><span class="va">poverty</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">kenya</span><span class="op">$</span><span class="va">poverty</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">kenya</span><span class="op">$</span><span class="va">poverty</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.18 0.43 0.90</code></pre>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">kenya</span><span class="op">$</span><span class="va">poverty</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##   0%  50% 100% 
## 0.18 0.43 0.90</code></pre>
<p>The <code>probs</code> argument allows us to specify the percentile(s) we want. Two of the most important percentiles are the 2.5th and 97.5th because they define the <em>95% interval</em>, a central range which includes 95% of the values.</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">kenya</span><span class="op">$</span><span class="va">poverty</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##  2.5% 97.5% 
##  0.22  0.66</code></pre>
<p>The interval between these two percentiles includes 95% of all the values in the distribution. Depending on the context, this interval is sometimes called a “confidence interval” or “uncertainty interval” or “compatibility interval.” Different percentile ranges create intervals of different widths.</p>
<p>If there is an <code>NA</code> value in the variable, any statistical function like <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> will return <code>NA</code>. You can fix this by using <code>na.rm = TRUE</code> within the statistical function.</p>
</div>
<div id="group_by" class="section level3" number="1.4.9">
<h3>
<span class="header-section-number">1.4.9</span> <code>group_by()</code><a class="anchor" aria-label="anchor" href="#group_by"><i class="fas fa-link"></i></a>
</h3>
<p>We can the use <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> with <code>summarize()</code> to calculate the average age for all the people in <code>trains</code>, as we did above.</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarize</span><span class="op">(</span>avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##     avg
##   &lt;dbl&gt;
## 1  42.4</code></pre>
<p>What if we want the mean <code>age</code> for each <code>gender</code>? Consider:</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">gender</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 115 x 15
## # Groups:   gender [2]
##    treatment att_start att_end gender race  liberal party     age income line   
##    &lt;fct&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;lgl&gt;   &lt;chr&gt;   &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;  
##  1 Treated          11      11 Female White FALSE   Democr…    31 135000 Framin…
##  2 Treated           9      10 Female White FALSE   Republ…    34 105000 Framin…
##  3 Treated           3       5 Male   White TRUE    Democr…    63 135000 Framin…
##  4 Treated          11      11 Male   White FALSE   Democr…    45 300000 Framin…
##  5 Control           8       5 Male   White TRUE    Democr…    55 135000 Framin…
##  6 Treated          13      13 Female White FALSE   Democr…    37  87500 Framin…
##  7 Control          13      13 Female White FALSE   Republ…    53  87500 Framin…
##  8 Treated          10      11 Male   White FALSE   Democr…    36 135000 Framin…
##  9 Control          12      12 Female White FALSE   Democr…    54 105000 Framin…
## 10 Treated           9      10 Male   White FALSE   Republ…    42 135000 Framin…
## # … with 105 more rows, and 5 more variables: station &lt;chr&gt;, hisp_perc &lt;dbl&gt;,
## #   ideology_start &lt;int&gt;, ideology_end &lt;int&gt;, income_in_thousands &lt;dbl&gt;</code></pre>
<p>The data is the same as before, but note the “Groups” message at the top. R is informing you that this tibble has been grouped so that any operation you perform now will be done for each <code>gender</code>.</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">gender</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarize</span><span class="op">(</span>avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   gender   avg
##   &lt;chr&gt;  &lt;dbl&gt;
## 1 Female  41.0
## 2 Male    43.5</code></pre>
<p>Notice the message R sends us. The warning means that the tibble which issues forth from the end of the pipe has been “ungrouped.” This means the group attribute we applied with <code>group_by()</code> has been removed. This behavior is the (sensible) default.</p>
<p>The proper way to handle the situation, here and everywhere else that we use <code>group_by()</code> and <code>summarize()</code>, is to specify the <code>.groups</code> argument.</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">trains</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">gender</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarize</span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>,
            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   gender  mean
##   &lt;chr&gt;  &lt;dbl&gt;
## 1 Female  41.0
## 2 Male    43.5</code></pre>
<p>This code does the same thing as the first version, but does not issue a message, since we have made an affirmative decision to drop any grouping variables.</p>
<p>The <code>group_by()</code> function doesn’t change data frames by itself. Rather it changes the <em>meta-data</em>, or data about the data, specifically the grouping structure. It is only after we apply the <code>summarize()</code> function that the tibble changes.</p>
<p>If you have a tibble which has been grouped, you can remove the grouping variable by using <code>ungroup()</code>.</p>
<p><em>When your R code is behaving in a weird way, especially when it is “losing” rows, the problem is often solved by using <code>ungroup()</code> in the pipeline.</em></p>
</div>
</div>
<div id="advanced-plots" class="section level2" number="1.5">
<h2>
<span class="header-section-number">1.5</span> Advanced Plots<a class="anchor" aria-label="anchor" href="#advanced-plots"><i class="fas fa-link"></i></a>
</h2>
<!-- DK: Other stuff needed here? after_stat; plotting two geoms at once; scale_x for changing labels; scales:: for axis formatting. coord_cartesian() and xlim/ylim, which allows for zooming/rescaling graphs. Other? -->
<!-- - using scales to change the name and labels of a legend. -->
<!-- - facet_grid() to facet by more than 1 variable. -->
<!-- 1) Plots are ordered alphabetically if it is a character and by levels if it is a factor. Dates appear differently in plots. reorder() is useful. Cover this at start of advanced plotting. -->
<!-- 2) Purpose of Advanced plotting is to show the tools for making the plots that appear in socviz.co, chapters 3 and 4.  -->
<!-- BG: teach scalexcont, scaleycont, afterstat, late tricks in the book, do not worry about building gapminder -->
<p>Good visualizations teach. When you construct a plot, decide what message you want to convey. Here are some functions which may be helpful.</p>
<div id="plot-objects" class="section level3" number="1.5.1">
<h3>
<span class="header-section-number">1.5.1</span> Plot objects<a class="anchor" aria-label="anchor" href="#plot-objects"><i class="fas fa-link"></i></a>
</h3>
<p>Plots are R objects, just like tibbles. We can create them, print them and save them. Up until now, we have just “spat” them out in an R code chunk. Nothing wrong with that! Indeed, this is the most common approach to plotting in R. Sometimes, however, it is handy to work with a plot object. Consider:</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">train_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">trains</span>, 
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, 
                     y <span class="op">=</span> <span class="va">income</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>This is the same code as our first example with <code>geom_point()</code>. <code>train_plot</code> is an R object. This code does not print anything out. In order to make this plot appear, we need to print it out explicitly:</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">train_plot</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-104-1.png" width="100%"></div>
<p>Recall that typing the name of an object is the same thing as using <code><a href="https://rdrr.io/r/base/print.html">print()</a></code>. Now that we have this object, we can display it whenever we want.</p>
<p>But, sometimes, we want a permanent copy of the plot, saved to our computer. That is the purpose of <code>ggsave()</code>:</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggsave</span><span class="op">(</span>filename <span class="op">=</span> <span class="st">"enos_trains.jpg"</span>, 
       plot <span class="op">=</span> <span class="va">train_plot</span><span class="op">)</span></code></pre></div>
<p><code>ggsave()</code> uses the suffix of the provided <code>filename</code> to determine the type of image to save. Because we use “enos_trains.jpg,” the file is saved in JPEG format. If we had used “enos_trains.png,” the file would have been saved as a PNG. We can display a saved file by using <code><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">knitr::include_graphics()</a></code>. For example:</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span><span class="st">"enos_trains.jpg"</span><span class="op">)</span></code></pre></div>
<p>This code displays the image in an Rmd, assuming that the file “enos_trains.jpg” is located in the current working directory. A common scenario is that we create an image and store it in a directory named <code>figures/</code> and then use that figure in more than one Rmd.</p>
</div>
<div id="faceting" class="section level3" number="1.5.2">
<h3>
<span class="header-section-number">1.5.2</span> Faceting<a class="anchor" aria-label="anchor" href="#faceting"><i class="fas fa-link"></i></a>
</h3>
<p>Faceting splits a visualization into parts, one for each value of another variable.. This will create multiple copies of the same type of plot with matching x and y axes, but whose contents will differ.</p>
<p>Before we proceed, let’s create a subset of the tibble <code>gapminder</code>, from the <strong>gapminder</strong>, package to use. (You may need to install the <strong>gapminder</strong> package for this code to work. Refer back to the introduction if you need a refresher on how to do so.)</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jennybc/gapminder">gapminder</a></span><span class="op">)</span>
<span class="va">gapminder_filt</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span> 
      <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span>, <span class="va">continent</span> <span class="op">!=</span> <span class="st">"Oceania"</span><span class="op">)</span></code></pre></div>
<p>Let’s plot our filtered data using <code>geom_point()</code></p>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder_filt</span>, 
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, 
                     y <span class="op">=</span> <span class="va">lifeExp</span>, 
                     color <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-108-1.png" width="100%"></div>
<p>It is difficult to compare the continents despite the colors. It would be much easier if we could “split” this scatterplot by the 4 continents. In other words, we would create plots of <code>gdpPercap</code> and <code>lifeExp</code> for each <code>continent</code> separately. We do this by using the function <code>facet_wrap()</code> with the argument <code>~ continent</code>. In <code>facet_wrap</code>, you must always put the tilde (~) in front of the variable you wish to wrap it by.</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder_filt</span>, 
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, 
                     y <span class="op">=</span> <span class="va">lifeExp</span>, 
                     color <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">continent</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-109-1.png" width="100%"></div>
<p>This is much better! We can specify the number of rows and columns in the grid by using the <code>nrow</code> argument inside of <code>facet_wrap()</code>. Let’s get all continents in a row by setting <code>nrow</code> to 1. Let’s also add a trend line <code>geom_smooth()</code> to our faceted plot.</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder_filt</span>, 
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, 
                     y <span class="op">=</span> <span class="va">lifeExp</span>, 
                     color <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">continent</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, 
              formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, 
              se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-110-1.png" width="100%"></div>
<p>As expected, we can see a positive correlation between economic development and life expectancy on all continents.</p>
</div>
<div id="stats" class="section level3" number="1.5.3">
<h3>
<span class="header-section-number">1.5.3</span> Stats<a class="anchor" aria-label="anchor" href="#stats"><i class="fas fa-link"></i></a>
</h3>
<p>Consider the following histogram.</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, 
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> 
  <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">20</span>, 
                 color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-111-1.png" width="100%"></div>
<p>Recall that the y-aesthetic of a histogram — the count of the observations in each bin — gets computed automatically. We can use the <code>after_stat()</code> argument within <code>geom_histogram()</code> to generate percent values as our y-aesthetic.</p>
<!-- HL: should probably explain what after_stat does. So do so! -->
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gapminder</span>, 
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="fu">after_stat</span><span class="op">(</span><span class="va">count</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, 
                   bins <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Percentage"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-112-1.png" width="100%"></div>
</div>
<div id="axis-limits-and-scales" class="section level3" number="1.5.4">
<h3>
<span class="header-section-number">1.5.4</span> Axis Limits and Scales<a class="anchor" aria-label="anchor" href="#axis-limits-and-scales"><i class="fas fa-link"></i></a>
</h3>
<div id="coord_cartesian" class="section level4" number="1.5.4.1">
<h4>
<span class="header-section-number">1.5.4.1</span> <code>coord_cartesian()</code><a class="anchor" aria-label="anchor" href="#coord_cartesian"><i class="fas fa-link"></i></a>
</h4>
<p>We can also manipulate the limits of the axes by using <code><a href="https://rdrr.io/r/graphics/plot.window.html">xlim()</a></code> and <code><a href="https://rdrr.io/r/graphics/plot.window.html">ylim()</a></code> within a call to <code>coord_cartesian()</code>. For example, assume that we are only interested in countries with a GDP per capita from 0 to 30,000. Recall that, because <code>data</code> is the first argument and <code>mapping</code> is the second to <code>ggplot()</code>, we don’t actually have to name the arguments. We can just provide them, as long as they are in the correct order.</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">gapminder_filt</span>, 
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>, y <span class="op">=</span> <span class="va">lifeExp</span>, color <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">continent</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_cartesian</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30000</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-113-1.png" width="100%"></div>
<p>We can see that the GDP per capita on the x-axis is now only shown from 0 to 30,000.</p>
</div>
<div id="scale_x-and-scale_y" class="section level4" number="1.5.4.2">
<h4>
<span class="header-section-number">1.5.4.2</span> <code>scale_x</code> and <code>scale_y</code><a class="anchor" aria-label="anchor" href="#scale_x-and-scale_y"><i class="fas fa-link"></i></a>
</h4>
<p>We can also change the scaling of the axes. For example, it might be useful to display the axes on a logarithmic scale by using <code>scale_x_log10()</code> or <code>scale_y_log10()</code>. Also, note that we can (lazily!) not provide the explicit <code>x</code> and <code>y</code> argument names to <code>aes()</code> as long as we provide the values in the right order: <code>x</code> comes before <code>y</code>.</p>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">gapminder_filt</span>, 
       <span class="fu">aes</span><span class="op">(</span><span class="va">gdpPercap</span>, <span class="va">lifeExp</span>, color <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">continent</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_smooth</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_x_log10</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-114-1.png" width="100%"></div>
<!-- BG: Need scale_x_cont and scale_y_cont here -->
<p>Beyond <code>scale_x_log10()</code>, there are other ways to change the scales. We will cover <code>scale_y_continuous</code> and <code>scale_x_continuous</code> in this section.</p>
<p>There are two major uses for <code>scale_x_continuous</code>, and that is to change the breaks and the labels. Take the graph below.</p>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">gapminder_filt</span>, 
       <span class="fu">aes</span><span class="op">(</span><span class="va">gdpPercap</span>, <span class="va">lifeExp</span>, color <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">continent</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_smooth</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-115-1.png" width="100%"></div>
<p>We only want there to be breaks on the y-axis every 20 years instead of every 10. We also want to add dollar signs to the x-axis, and to have breaks every 20,000 dollars. Let’s fix the graph!</p>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">gapminder_filt</span>, 
       <span class="fu">aes</span><span class="op">(</span><span class="va">gdpPercap</span>, <span class="va">lifeExp</span>, color <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">continent</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_smooth</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">60</span>, <span class="fl">80</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_continuous</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_dollar.html">dollar_format</a></span><span class="op">(</span><span class="op">)</span>,
                     breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20000</span>, <span class="fl">40000</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="book_temp_files/figure-html/unnamed-chunk-116-1.png" width="100%">
Let’s break this down. We used the <code>breaks</code> argument to create the breaks on the scale. We used the <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> function to specify what breaks we wanted. Then, we used <code>labels</code> to modify the labels on the x-axis. The <code><a href="https://rdrr.io/r/base/ns-dblcolon.html">::</a></code> allows us to extract a function from a specific package, if the function exists in multiple packages. So, we specifically extract the <code>dollar_format</code> function from the <code>scales</code> package to change the labels of the x-axis.</p>
<p>There is another function called <code>scale_x_discrete/scale_y_discrete</code>. This function is similar enough to <code>scale_y/x_continuous</code> that we will not give it its own section. The only difference in the usage of the discrete vs. continuous function is that the discrete function is applied to <strong>discrete variables</strong>. Discrete variables are those that are countable (i.e. the number of tables in a room) with nothing in between, whereas continuous variables have infinite possibilities (i.e. height has infinite possibilities).</p>
</div>
</div>
<div id="text" class="section level3" number="1.5.5">
<h3>
<span class="header-section-number">1.5.5</span> Text<a class="anchor" aria-label="anchor" href="#text"><i class="fas fa-link"></i></a>
</h3>
<p>Recall we use <code>labs()</code> to add labels and titles to our plots.
We can also change labels inside the plots using <code>geom_text()</code>.</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">gapminder_filt</span>, 
       <span class="fu">aes</span><span class="op">(</span><span class="va">gdpPercap</span>, <span class="va">lifeExp</span>, color <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">continent</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_smooth</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_x_log10</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Life Expectancy and GDP per Capita (2007)"</span>,
       subtitle <span class="op">=</span> <span class="st">"Selected Nations by Continent"</span>,
       x <span class="op">=</span> <span class="st">"GDP per Capita, USD"</span>,
       y <span class="op">=</span> <span class="st">"Life Expectancy, Years"</span>,
       caption <span class="op">=</span> <span class="st">"Source: Gapminder"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">country</span><span class="op">)</span>, 
            size <span class="op">=</span> <span class="fl">2</span>, 
            color <span class="op">=</span> <span class="st">"black"</span>, 
            check_overlap <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-117-1.png" width="100%"></div>
<p>Let’s breakdown the code within <code>geom_text()</code>. We included a new aesthetic called <em>label</em>. This defines the character variable which will be used as the basis for the labels. We set <code>label</code> to country so each point corresponds to the country it represents. We set the text font by setting <code>size</code> to 2, and we set the text color by using <code>color</code>. Finally, we included the argument <code>check_overlap = TRUE</code> to make sure the names of the countries were legible.</p>
</div>
<div id="themes" class="section level3" number="1.5.6">
<h3>
<span class="header-section-number">1.5.6</span> Themes<a class="anchor" aria-label="anchor" href="#themes"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Themes</strong> can be used to change the overall appearance of a plot without much effort. We add themes as layers to our plots. You can find an overview of the different themes in <strong>ggplot</strong> <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">here</a>.</p>
<p>Consider the following faceted scatterplot.</p>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">continent</span> <span class="op">!=</span> <span class="st">"Oceania"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">gdpPercap</span>, <span class="va">lifeExp</span>, color <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, 
                formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>,
                se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">continent</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Life Expectancy and GDP per Capita"</span>,
         subtitle <span class="op">=</span> <span class="st">"Connection between GDP and life expectancy is weakest in Africa"</span>,
         x <span class="op">=</span> <span class="st">"GDP per Capita in USD"</span>,
         y <span class="op">=</span> <span class="st">"Life Expectancy"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_x_log10</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">5000</span>, <span class="fl">50000</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-118-1.png" width="100%"></div>
<p>Note the use of the <code>breaks</code> argument to <code>scale_x_log10()</code>. This specifies the location of labels on the x-axis. We can also use the <code>labels</code> argument if we want to change their appearence. These tricks work in the entire family of <code>scale_*</code> functions.</p>
<p>Let’s now add a theme to our faceted scatterplot. We will use the theme <code><a href="https://rdrr.io/pkg/ggthemes/man/theme_economist.html">theme_economist()</a></code>, from the <strong>ggthemes</strong> package, to make our plot look like the plots in the <em>The Economist</em>.</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jrnold/ggthemes">ggthemes</a></span><span class="op">)</span>

<span class="va">gapminder</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">continent</span> <span class="op">!=</span> <span class="st">"Oceania"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">gdpPercap</span>, <span class="va">lifeExp</span>, color <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, 
                formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>,
                se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">continent</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Life Expectancy and GDP per Capita"</span>,
         subtitle <span class="op">=</span> <span class="st">"Connection between GDP and life expectancy is weakest in Africa"</span>,
         x <span class="op">=</span> <span class="st">"GDP per Capita in USD"</span>,
         y <span class="op">=</span> <span class="st">"Life Expectancy"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_x_log10</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">5000</span>, <span class="fl">50000</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggthemes/man/theme_economist.html">theme_economist</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-119-1.png" width="100%"></div>
<p>This looks pretty good. However, notice the legend the top of our graph. It crowds our graph and takes away from the most important part: the data. We can use <code>theme()</code> to customize the non-data parts of our plots such as background, gridlines, and legends. Let’s de-clutter the graph by removing our legend. We can do this by using the <code>legend.position</code> argument and setting it to “none.”</p>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">continent</span> <span class="op">!=</span> <span class="st">"Oceania"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">gdpPercap</span>, <span class="va">lifeExp</span>, color <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, 
                formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>,
                se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">continent</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Life Expectancy and GDP per Capita"</span>,
         subtitle <span class="op">=</span> <span class="st">"Connection between GDP and life expectancy is weakest in Africa"</span>,
         x <span class="op">=</span> <span class="st">"GDP per Capita in USD"</span>,
         y <span class="op">=</span> <span class="st">"Life Expectancy"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_x_log10</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">5000</span>, <span class="fl">50000</span><span class="op">)</span>,
                  labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_dollar.html">dollar_format</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://rdrr.io/pkg/ggthemes/man/theme_economist.html">theme_economist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-120-1.png" width="100%"></div>
<p>Great. Now our graph is easier to visualize.</p>
<div id="theme" class="section level4" number="1.5.6.1">
<h4>
<span class="header-section-number">1.5.6.1</span> theme()<a class="anchor" aria-label="anchor" href="#theme"><i class="fas fa-link"></i></a>
</h4>
<p>The <code>theme()</code> function also offers a wide <a href="https://ggplot2.tidyverse.org/reference/theme.html">selection</a> of functions for manually changing individual elements. We will cover the most widely used ones here, but the vast majority will be listed in that link.</p>
<p>There are two key elements in the <code>theme()</code> function.</p>
<ul>
<li>
<strong>Theme elements</strong>: these specify the non-data elements you can control. For example, <code>panel.border</code> is the element that controls the border of the grid area.</li>
<li>
<strong>Element function</strong>: this describes the visual properties of the element. There are four main element functions, <code>element_blank()</code>, <code>element_rect()</code>, <code>element_line()</code>, <code>element_text()</code>.
<ul>
<li>
<strong>element_blank()</strong>: this hides the element from the theme.</li>
<li>
<strong>element_line()</strong>: this modifies elements that are plot lines, grid lines, axes, etc.</li>
<li>
<strong>element_text()</strong>: this changes the text elements of the plot, like titles, captions, etc.</li>
<li>
<strong>element_rect()</strong>: rectangle elements control the background of plots, legends, etc.</li>
</ul>
</li>
</ul>
<p>Let’s look at an example of how we might want to modify a graph. Take this graph below.</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">economics</span>,
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>,
                     y <span class="op">=</span> <span class="va">unemploy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Unemployed Population in the United States: 1965 - 2015"</span>,
       subtitle <span class="op">=</span> <span class="st">"Dramatic spike during the Great Recesssion"</span>,
       x <span class="op">=</span> <span class="st">"Year"</span>,
       y <span class="op">=</span> <span class="st">"Number of Unemployed (in thousands)"</span>,
       caption <span class="op">=</span> <span class="st">"Source: FRED Economic Data"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-121-1.png" width="100%"></div>
<p>You have a couple of problems with this graph. Firstly, you want the title to be bold. You want there to be a light blue background. You also don’t particularly care for there to be so many grid lines from the x-axis. Let’s change this!</p>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">economics</span>,
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>,
                     y <span class="op">=</span> <span class="va">unemploy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Unemployed Population in the United States: 1965 - 2015"</span>,
       subtitle <span class="op">=</span> <span class="st">"Dramatic spike during the Great Recesssion"</span>,
       x <span class="op">=</span> <span class="st">"Year"</span>,
       y <span class="op">=</span> <span class="st">"Number of Unemployed (in thousands)"</span>,
       caption <span class="op">=</span> <span class="st">"Source: FRED Economic Data"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,
        panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span>,
        panel.grid.minor.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-122-1.png" width="100%"></div>
<p>There! Within the <code>theme()</code> function, we can change the plot title to bold, the background to blue, and get rid of the “minor” grid lines. <code>theme()</code> is a very versatile function. See the full list of elements <a href="https://ggplot2-book.org/polishing.html#polishing">here</a>.</p>
</div>
</div>
</div>
<div id="summary-2" class="section level2" number="1.6">
<h2>
<span class="header-section-number">1.6</span> Summary<a class="anchor" aria-label="anchor" href="#summary-2"><i class="fas fa-link"></i></a>
</h2>
<p><em>Tibbles are rectangular stores of data. They are a specific type of data frame, so we will use both terms interchangeably.</em></p>
<p><em>You need to practice every day.</em></p>
<p><em>Do not use pie charts.</em></p>
<p><em>Shield my eyes from your ugly messages and warning.</em></p>
<p><em>Each step in the pipe starts with a tibble and then, once it is done, produces a tibble. It is tibbles all the way down!</em></p>
<p><em>When your R code is behaving in a weird way, especially when it is “losing” rows, the problem is often solved by using <code>ungroup()</code> in the pipeline.</em></p>
<p><em>The two most important attributes of a distribution are its center and its variation around that center.</em></p>
<p>In this chapter, we first looked at basic coding terminology and concepts that we deal with when programming with R. We then learned about the three basic components that make up each plot: data, mapping, and one or more geoms. The <strong>ggplot2</strong> package offers a wide range of geoms that we can use to create different types of plots. Next, we examined the “super package” <strong>tidyverse</strong>, which includes helpful tools for visualization. It also offers features for importing and manipulating data, which is the main topic of Chapter @(wrangling). Lastly, we explored advanced plotting features such as axis scaling, faceting, and themes.</p>
<p>The main <em>statistical</em> concept we discussed was that of a “distribution,” a collection of related numbers. In R, these numbers are usually stored as a variable inside of a tibble. “Frequency distribution” and “empirical distribution” are common phrases to describe such objects. We learned how to calculate statistics — often referred to as “summary statistics” — about these distributions. The most important involve two concepts: the center of the distribution and the variability of the distribution. The center is most often summarized with the <em>mean</em> (<code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>) or the <em>median</em> (<code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>). Variability is measured with the standard deviation (<code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code>) or the scaled median absolute deviation (<code><a href="https://rdrr.io/r/stats/mad.html">mad()</a></code>) or the 95% confidence interval (<code><a href="https://rdrr.io/r/stats/quantile.html">quantile(probs = c(0.025, 0.975))</a></code>).</p>
<p>Recall the plot we began the chapter with:</p>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-123-1.png" width="100%"></div>
<p>You now know enough to make plots like this by yourself.</p>
<p>It is important to know that we have only seen a small part of what R offers. For example, we can use the <strong>gganimate</strong> package to bring plots to life:</p>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com">gganimate</a></span><span class="op">)</span>

<span class="va">gap_anim</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">continent</span> <span class="op">!=</span> <span class="st">"Oceania"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">gdpPercap</span>, <span class="va">lifeExp</span>, color <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_point</span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">continent</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_size</span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_x_log10</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Life Expectancy and GDP per Capita (1952-2007)"</span>,
         x <span class="op">=</span> <span class="st">"GDP per Capita, USD"</span>,
         y <span class="op">=</span> <span class="st">"Life Expectancy, Years"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme_linedraw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://gganimate.com/reference/transition_time.html">transition_time</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Year: {frame_time}"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://gganimate.com/reference/shadow_wake.html">shadow_wake</a></span><span class="op">(</span>wake_length <span class="op">=</span> <span class="fl">0.1</span>, alpha <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">gap_anim</span></code></pre></div>
<div class="inline-figure"><img src="book_temp_files/figure-html/unnamed-chunk-124-1.gif" width="100%"></div>
<p>A beautiful plot is just a collection of steps, each simple enough on its own. We have taught you (some of) these steps. Time to start walking on your own.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="getting-started.html">Getting Started</a></div>
<div class="next"><a href="wrangling.html"><span class="header-section-number">2</span> Wrangling</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#visualization"><span class="header-section-number">1</span> Visualization</a></li>
<li><a class="nav-link" href="#basic-r-commands"><span class="header-section-number">1.1</span> Basic R commands</a></li>
<li>
<a class="nav-link" href="#looking-at-data"><span class="header-section-number">1.2</span> Looking at data</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#examining-trains"><span class="header-section-number">1.2.1</span> Examining trains</a></li>
<li><a class="nav-link" href="#exploring-tibbles"><span class="header-section-number">1.2.2</span> Exploring tibbles</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#basic-plots"><span class="header-section-number">1.3</span> Basic Plots</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#geom_point"><span class="header-section-number">1.3.1</span> geom_point()</a></li>
<li><a class="nav-link" href="#geom_jitter"><span class="header-section-number">1.3.2</span> geom_jitter()</a></li>
<li><a class="nav-link" href="#geom_line"><span class="header-section-number">1.3.3</span> geom_line()</a></li>
<li><a class="nav-link" href="#geom_histogram"><span class="header-section-number">1.3.4</span> geom_histogram()</a></li>
<li><a class="nav-link" href="#geom_bar"><span class="header-section-number">1.3.5</span> geom_bar()</a></li>
<li><a class="nav-link" href="#geom_col"><span class="header-section-number">1.3.6</span> geom_col()</a></li>
<li><a class="nav-link" href="#geom_smooth"><span class="header-section-number">1.3.7</span> geom_smooth()</a></li>
<li><a class="nav-link" href="#geom_density"><span class="header-section-number">1.3.8</span> geom_density()</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#tidyverse"><span class="header-section-number">1.4</span> Tidyverse</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-wrangling"><span class="header-section-number">1.4.1</span> Data wrangling</a></li>
<li><a class="nav-link" href="#the-pipe-operator"><span class="header-section-number">1.4.2</span> The pipe operator: %&gt;%</a></li>
<li><a class="nav-link" href="#filter-rows"><span class="header-section-number">1.4.3</span> filter() rows</a></li>
<li><a class="nav-link" href="#select-variables"><span class="header-section-number">1.4.4</span> select variables</a></li>
<li><a class="nav-link" href="#slice-and-pull-and"><span class="header-section-number">1.4.5</span> slice() and pull() and []</a></li>
<li><a class="nav-link" href="#arrange"><span class="header-section-number">1.4.6</span> arrange()</a></li>
<li><a class="nav-link" href="#mutate"><span class="header-section-number">1.4.7</span> mutate()</a></li>
<li><a class="nav-link" href="#summarize"><span class="header-section-number">1.4.8</span> summarize()</a></li>
<li><a class="nav-link" href="#group_by"><span class="header-section-number">1.4.9</span> group_by()</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#advanced-plots"><span class="header-section-number">1.5</span> Advanced Plots</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#plot-objects"><span class="header-section-number">1.5.1</span> Plot objects</a></li>
<li><a class="nav-link" href="#faceting"><span class="header-section-number">1.5.2</span> Faceting</a></li>
<li><a class="nav-link" href="#stats"><span class="header-section-number">1.5.3</span> Stats</a></li>
<li><a class="nav-link" href="#axis-limits-and-scales"><span class="header-section-number">1.5.4</span> Axis Limits and Scales</a></li>
<li><a class="nav-link" href="#text"><span class="header-section-number">1.5.5</span> Text</a></li>
<li><a class="nav-link" href="#themes"><span class="header-section-number">1.5.6</span> Themes</a></li>
</ul>
</li>
<li><a class="nav-link" href="#summary-2"><span class="header-section-number">1.6</span> Summary</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/PPBDS/primer/blob/master/01-visualization.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/PPBDS/primer/edit/master/01-visualization.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Preceptor’s Primer for Bayesian Data Science</strong>" was written by David Kane. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
